---
title: "HR_analytics"
author: "Pankaj Shah"
date: "5/16/2019"
output:
  html_document:
    number_sections: true
    toc: true
    toc_float: true
    toc_depth: 4
    fig_width: 8
    fig_height: 6.0
    theme: yeti
    highlight: textmate
    code_folding: hide
    position: fixed;
    left: 0;
    top: 0;
    width: 200px;
    height: 100%;
    max-width: 800px;
    margin: auto;
    line-height: 20px;
    df_print: paged
    warning: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, error=FALSE)
```

<style>
body {
text-align: justify;
font-family: Times New Roman;
font-size: 14pt;}
</style>

```{r}
devtools::install_github("rstudio/rsconnect")
```

<font size = 6, color="red">**Buckle Up its a Exploratory Data Analysis**</font>


<center><font size = 4, color="green"><span style="background:yellow">**Hope you enjoy your journey.**</span></font></center>
    
<br>

```{r}

```

<center>
![](https://github.com/shahnp/Human_Resource_EDA/blob/master/I_quit.png?raw=true){width=50%}
</center>

\textcolor{red}{\textbf{~~~~~ Welcome !!!!}}

\textcolor{magenta}{This is magenta.}


# <span style="color:red">Human Resource Analytics</span>

Out of curiousity I took this datasets from one of the [Medium]("https://medium.com/@nafeea3000/human-resource-analytics-using-machine-learning-6a32392f6ec1")  article. My small step effort to understand the HR analytics part of it.Thank you Nafee Afshin for such a beautiful blog and various R community Kagglers and Coders for breaking it down and make easy to understand various elements of Human Resource.

We all know that there is job opening in every company every now and then. Depends upon size of human resource how often they have their position open. It's not easy for both employer and employee to find the right working conditions, satisfaction level and many other things to consider for a perfect match. Apart from finding perfect match both the epmloyer and employee need to invest both time and money to train within the companies policy and working condition, if there is new tool to learn they have to invest the time to learn. CRISP-DM stands for CRoss Industry Standard Process for Data Mining.

When we apply for the job or start working for any company we should be familiar with Human Resource Department of the organisation. In some big organization Human resource (HR) departments seems increasingly turning to analytics department by having Business Intelligence people working for them  to drive company hiring and workforce management more smoothly and within budget. As with every nooks and corner of the company (e.g. marketing, finance, etc), HR departments also do require analytics solutions which could be very unique to their domain and reltional database between departments. 

We might think in particular, HR departments would usually have 'small' datasets in relation to other departments which might not be true becuase HR department is very crucial department for growth of the company. They are more intepretaion driven than predictive based model driven. 

General skills can be transfered from organisation to organisation but how to apply those tools depends upon the goal of the company and the projects everyone is involved. It all depends upon what is the motive behind working. The goal of most of the company is to utilise its manpower in right direction so that it can propel its ship smoothly. There is always bumps on the way, someone leaving the company for better future, family and better offer when someone has skills & proper talent. It is definetly not in favorable condition for the company to loose hardworking and good ethics employeer. But wouldn't it be ideal for the company to invest time to find the reason What makes employer leave the company. If it just because of current Manager,Employeer Working Satisfaction, distance to commute, Working Environment etc. There are various factors if one need to consider what makes Employee/ Emloyeer happy.  It is balance of lot of things which play critical role. I am trying to explore some of this with this small datasets . We all love Revenue turnover whether we are employee or employeer but no one likes Employee Churn over ratio or  Attrition. Lets dive in and see what can we find from this datasets.

Attrition: **It is basically the turnover rate of employees inside an organization.**

The goal of this particular project would be find if there is any relationship between the variables and if we could find the insights for Employee Churn over the period of time. If possible I would love to do some Machine learning to predict the Churn ratio over period of time.

Just to make things little clear Human Analytics is not only gathering data about employee and increasing efficiency but also its aim is to return better ROI for the company and keep employee happy with the fulfillment of need and happier workplace enivironment. If we could better understand the patterns and take right steps we all wil be benefitting from each other.

So lets start diving into our datasets by importing necessary libraries.

Library 

```{r, message=FALSE,message=FALSE}
library("ggplot2") # Data Viz.
library("dplyr") # EDa
library("tidyr") # EDA
library("ggthemes") # Data Viz.
library("cowplot")
library("DataExplorer") # EDA
library("kableExtra")
library("ggridges")
library("plotly")
library("gmodels")
library("plotrix") # for pyramid.plot
library("forcats") # for factor reorder
library("reshape") # for melt
library("waterfalls")
library("tree")
library("RColorBrewer")
library("treemapify")
library("data.table")
library("ggrepel") # Repel the text from overlapping
library("janitor")
library("formattable") #Table
library("scales")
library("DT")
```

# <span style="color:red">DATA INSIGHTS:</span>

Lets have a glimpse of our datasets.
```{r}
hr_df<-read.csv("https://raw.githubusercontent.com/shahnp/Human_Resource_EDA/master/HR.csv", sep = ",") 
original_df <- hr_df # Save Original data for later use.
glimpse(hr_df) # Summary from dplyr Func.
```

# <span style="color:red">Exploratory Data Analysis</span>

```{r}
# Writing function to get info about our datasets:

df_info <- function(x) {
  data  <- as.character(substitute(x))  # data frame name
  size <- format(object.size(x), units="Mb")  # size (Mb)
  plot_missing(data.frame(x)) # Vizualization of Missing Data.
  
  ##column information
  column.info <- data.frame( column        = names(sapply(x, class)),
                             class         = sapply(x, class),
                             unique.values = sapply(x, function(y) length(unique(y))),
                             missing.count = colSums(is.na(x)),
                             missing.pct   = round(colSums(is.na(x)) / nrow(x) * 100, 2)) %>% arrange(desc(unique.values))
                            
  row.names(column.info) <- 1:nrow(column.info)
  list(data.frame     = data.frame(name=data, size=size),
       dimensions     = data.frame(rows=nrow(x), columns=ncol(x)),
       column.details = column.info)
}
print("Missing Data")
df_info(hr_df) # Info about datasets.
```

We have almost 1200 rows of data with 28 variables.
Total size of our datasets is 0.2MB.

**Sanity Check:**

Look for any missing Rows and the graph shows no missing rows.Aww thats so sweet we don't have any missing data at all. It seems like we have clean datasets which happens rarely in Data Analytics field and especially in People Analytics as lot of information are personal and because of privacy, confidentaility lots of data are not provided publicly.

##<span style="color:magenta">**Head**</span>


We will analyse most of the individuals variables at first and then try to link dependent and independent variables for both machine learning and Exploratory Data Analysis.

Lets start by Exploratory Data Analysis. Lets look at the top of the table to get sense of datasets.

```{r}
kable(head(hr_df,5)) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive", full_width = F, position = "left", font_size = 7)) %>%
  column_spec(5, width = "30em", background = "lightsalmon") %>% 
  row_spec(3:5, bold = T, color = "white", background = "lightsalmon") %>% 
  scroll_box(width = "800px", height = "200px")
```

##<span style="color:magenta">**Sample**</span>

By looking at the top of table we should usually get the sense of what kind of datasets we are dealing with. What does the column and value represents. But going one further step I usually love to randomly sample my datasets to find something new. It doesnt take long time but saves much time if I could catch something fishy in the beginning of the analysis.

If I have small set of data I usually use sample_n to pass around and get sense.We could also use sample_frac to see more random fraction of data. 

```{r}
# formattable(sample_n(hr_df, 2),align="l")

formattable(sample_n(hr_df, 2),
            align="l",
            list(Gender=color_tile("lightsalmon","green"),
                 EducationBackground=color_bar("cyan"),
                 EmpJobRole=color_bar("darkorchid"),
                 style = ~ style(color = "black",font.weight = "bold")))

# formattable(hr_df, 
#             align =c("l","c","c","c","c", "c", "c", "c", "r"), 
#             list(`EmpNumber` = formatter(
#               "span", style = ~ style(color = "black",font.weight = "bold")) 
# ))
```

##<span style="color:magenta">**Data Lookup**</span>

At first glance,by running Random Sample all the datasets looks normal. Lets see how many unique value each column has so that we can get more gist of it.

If we would like to get more sense of data. I usually run the unique code in each column to know which field are interesting enough to diagnose. If any column have handful of unique values it is easy to look into without wasting lot of times. 

```{r}
unique(unlist(hr_df$Gender)) 
unique(unlist(hr_df$MaritalStatus)) 
# unique(unlist(hr_df[ ,5:8]))  # You can pass particular range of column name to get 
```

##<span style="color:magenta">**Duplicate data**</span>


```{r}
get_dupes(hr_df,EmpNumber) # Emp Number unique.
hr_df <- distinct(hr_df) # drop all iterative rows
dim(hr_df)
```

##<span style="color:magenta">**Range**</span>


If we would like to drill down each column then we can do this by following way knowing min and max value of each column which give you sense of how spread your data is.Sometimes you can catch the outliers easily instead of plotting boxplot everytime.

```{r}
t(apply(hr_df, MARGIN = 2, function(x) range(x, na.rm=TRUE))) %>% kable()
```

##<span style="color:magenta">**Recode**</span>

Lets Recode some of our attributes for quick analysis as well as to fit better in our graphical representation.

i. EmpDepartment
ii. Education Level
iii. Age_bin
iv. Generation
v. Hike Percentage
vi. Years With manager
vii. Emp HourlyRate

```{r}

# i. Department:
replace_with <- list("Data Science" ="DS","Human Resources" = "HR","Research & Development" = "R&D")

hr_df <- hr_df %>% mutate(EmpDepartment = recode(EmpDepartment, !!!replace_with))

knitr::kable(table(hr_df$EmpDepartment),caption = "This is the Employee Department")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")

# ii. Education Level:
hr_df$Educational_Levels <- ifelse(hr_df$EmpEducationLevel == 1,"No College Degree",
                            ifelse(hr_df$EmpEducationLevel == 2,"College Degree",
                            ifelse(hr_df$EmpEducationLevel == 3,"Bachelors Degree",
                            ifelse(hr_df$EmpEducationLevel == 4,"Masters Degree", "Phd"))))

table(hr_df$Educational_Levels) %>% prop.table() %>% kable(caption = "This is the Education Level")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")

# iii. Age_bin
hr_df<- hr_df %>% mutate(Age_bin = ifelse(Age %in% seq(1,20), "0_20",
                                    ifelse(Age %in% seq(21,30), "20_30",
                                      ifelse(Age %in% seq(31,40), "30_40",
                                        ifelse(Age %in% seq(41,50), "40_50",
                                          ifelse(Age %in% seq(51,60), "50_60",
                                            ifelse(Age %in% seq(61,80), "60_80","old")))))))

table(hr_df$Age_bin) %>% prop.table() %>% kable(caption = "This is the Age_bin distribution",booktabs = T)%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")

# iv. Generation
hr_df$Generation <- ifelse(hr_df$Age>=10 & hr_df$Age<29,"Millenials Gen Y.1",      
                    ifelse(hr_df$Age>=29 & hr_df$Age<39,"Millenials Gen Y.2", 
                    ifelse(hr_df$Age>=39 & hr_df$Age<55,"Gen Xers",
                    ifelse(hr_df$Age>=55 & hr_df$Age<76,"Baby Boomers","Silent"))))

table(hr_df$Generation) %>% kable(caption = "This is the Generation distribution")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")


# v. Hike Percentage
hr_df$Hike_Pct <- ifelse(hr_df$EmpLastSalaryHikePercent>=11 & hr_df$EmpLastSalaryHikePercent<13,"11-13",
                    ifelse(hr_df$EmpLastSalaryHikePercent>=13 & hr_df$EmpLastSalaryHikePercent<16,"14-16",
                    ifelse(hr_df$EmpLastSalaryHikePercent>=16 & hr_df$EmpLastSalaryHikePercent<20,"17-20",  
                    ifelse(hr_df$EmpLastSalaryHikePercent>=20 & hr_df$EmpLastSalaryHikePercent<23,"21-23",
                    ifelse(hr_df$EmpLastSalaryHikePercent>=23 & hr_df$EmpLastSalaryHikePercent<26,"24-26","28+")))))

table(hr_df$Hike_Pct) %>% kable(caption = "This is the Salary Hike Percentage distribution")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")

# vi. Years With manager
hr_df$CatYearsManager <- ifelse(hr_df$YearsWithCurrManager < 1, "Recently Hired Newbie",
                          ifelse(hr_df$YearsWithCurrManager >= 1 & hr_df$YearsWithCurrManager <= 2, "1-2 years Old",     
                        ifelse(hr_df$YearsWithCurrManager > 2 & hr_df$YearsWithCurrManager <= 5, "2-5 Years hired",
                               ifelse(hr_df$YearsWithCurrManager > 5 & hr_df$YearsWithCurrManager <= 10, "5-10 Years Vet"," Pro-Veteran"))))

table(hr_df$CatYearsManager) %>% kable(caption = "This is the relationship with Manager in years distribution")%>% kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")

# vii. Hourly_bin
hr_df<- hr_df %>% mutate(hourly_bin = ifelse(EmpHourlyRate %in% seq(30,39), "30_39",
                                    ifelse(EmpHourlyRate %in% seq(40,49), "40_49",
                                      ifelse(EmpHourlyRate %in% seq(50,59), "50_59",
                                        ifelse(EmpHourlyRate %in% seq(60,69), "60_69",
                                          ifelse(EmpHourlyRate %in% seq(70,79), "70_79",
                                            ifelse(EmpHourlyRate %in% seq(80,89), "80_89", 
                                             ifelse(EmpHourlyRate %in% seq(90,100), "90_100","00"))))))))

table(hr_df$hourly_bin) %>% kable(caption = "This is the Hourly Rate distribution")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")
```


#<span style="color:red">Gender</span>


Lets start to dig in with the Gender distribution.

i. Employee Distribution Count by Gender
ii. How is Male and Female distributed Across the Department ?

```{r}
# i. Employee Distribution Count by Gender

p1 <- hr_df %>% 
group_by(Gender) %>% 
dplyr::summarise(count = n()) %>% 
mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
  
# Plot
ggplot(aes(x = Gender, y = gender_pct,fill =Gender, color=Gender))+
geom_bar(stat = "identity",color = "gray")+
coord_flip()+
  
# Theme: 
theme_gdocs()+
theme(panel.grid.major = element_line("white"), # grid lines matching to minimal 
      panel.grid.minor = element_line("white"))+ # grid lines matching to minimal 
  
# Title, X & Y label:
labs(title="",
     x ="Gender",
     y ="Percentage (%)") + 
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+ 
theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  
# Text: 
geom_text(aes(x= Gender, label = paste0(count, sep = "")),
              hjust =-1, position = position_stack(vjust =0.5), size = 5, color = 'black', fontface = 'bold')+
geom_label(aes(label=paste0(gender_pct, "%")), color="midnightblue", fontface = "bold.italic",size = 5)+ 
  
# Fill:
scale_fill_manual(values=c("hotpink","deep sky blue")) +  # inside color of the box
scale_color_manual(values=c("hotpink","deep sky blue"))+  # Outter color of box

# Legend: 
theme(legend.position="none")

title <- ggdraw() + draw_label("Distribution of Workforce by Gender", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p1 ,nrow = 1,labels = "A") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1, 1))

# ii. How is Male and Female distributed Across Department? 

# Male Stats:
male_stat <- hr_df %>%
    filter(Gender=="Male") %>%
    group_by(EmpDepartment) %>%
    dplyr::summarise(m_count = n()) %>%
    mutate(pct_m = round(prop.table(m_count),2)*100) %>%
    arrange(desc(m_count)) 

# Male Plot:
male_plot <-ggplot(male_stat,aes(x = reorder(EmpDepartment,m_count), y = m_count, fill = EmpDepartment))+
            geom_bar(stat = "identity")+
            coord_flip()+
            theme_hc()+
            labs(title = "Distribution of Workforce", x = "Department", y = "Male count")+
            theme(plot.title = element_text(size = 15, hjust = 0.5, color = "red", face="bold.italic"))+
            geom_label(aes(label = paste0(pct_m,"%")), vjust = 1.2, color = "black", 
                       position = position_dodge(0.9), size = 2.2)+
            scale_fill_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE", "#8B8682", "#CD96CD"))+
            scale_color_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE", "#8B8682", "#CD96CD"))+
            theme(legend.position = "none")
           
# Female Stats:
female_stat <- hr_df %>%
               filter(Gender=="Female") %>%
               group_by(EmpDepartment) %>%
               dplyr::summarise(f_count = n()) %>%
               mutate(pct_f = round(prop.table(f_count),2)*100) %>%
               arrange(desc(f_count))

# Female Plot:
female_plot <- ggplot(female_stat,aes(x = reorder(EmpDepartment,f_count), y = f_count, fill = EmpDepartment))+
               geom_bar(stat = "identity")+
               coord_flip()+
               theme_hc()+
               labs(x = "Department", y = "Female count")+
               geom_label(aes(label = paste0(pct_f,"%")), vjust = 1.2,
                         color = "black", position = position_dodge(0.9), size = 2.2)+
               scale_fill_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE", "#8B8682", "#CD96CD"))+
               scale_color_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE","#8B8682", "#CD96CD"))+
               theme(legend.position = "none")
            
# Join Male and Female Stats in one Dataframe
joined_stat <- inner_join(male_stat,female_stat, by = "EmpDepartment")

# Create new Column Male and Female Percentage
male_pct <- joined_stat %>% select(pct_m,EmpDepartment) %>% arrange(EmpDepartment) 
female_pct <- joined_stat %>% select(pct_f,EmpDepartment) %>% arrange(EmpDepartment)

# Pyramid Plot
par(mar = pyramid.plot(male_pct$pct_m,
                       female_pct$pct_f,
                       laxlab= c(0,10,20,30,35),
                       raxlab=c(0,10,20,30,35),
                       labels = unique(joined_stat$EmpDepartment),
                       top.labels=c("Male %","EmployeeJob Role","Female %"),
                       main = "Gender distribution across the Department",
                       #col.main="red", col.lab="blue", col.sub="black",
                       gap =7, show.values = T, #show.values = T to see values on top of each bar.
                       rxcol = c("hotpink"),
                       lxcol = c("deep sky blue")))

# Joined Dataframe:

formattable(joined_stat,align="l",list(EmpDepartment=color_tile("lightsalmon","grey"),male_pct=color_bar("cyan"),female_pct=color_bar("darkorchid"),style = ~ style(color = "black",font.weight = "bold")))
```


**A**

- 60% Male and 40% Female.

**B**

Above chart shows how Female and Male population are distributed among Department.
Male population are equally distributed among the top three branches of the organisation whereas we can see slight deviation in Female department. Females seems to love the Sales department out of all brances.

# <span style="color:red">EmpDepartment</span>

- i. Waterfall Chart
- ii. Pie chart
- iii. Donut Chart

**Employee distributed among the Organization**

```{r}
# Number of Employees in each department.
dept_aa <- hr_df %>% group_by(EmpDepartment) %>% summarise(count = n())

# i.  Waterfall Chart
waterfall(dept_aa, 
          calc_total=TRUE,
           fill_colours = NULL,
          total_axis_text = "Total_count",
          total_rect_text_color="black",
          total_rect_color="goldenrod1") +
theme_economist()+
#scale_y_continuous(label=scales::percent) # y Scale in % 
labs(title = "Employee distribution among different Departments", 
        x = "Department", 
        y = "Count")+
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))

# ii. Plotly Pie chart:
colors <- c(c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE", "#8B8682", "#CD96CD"))

dept_pie <- hr_df %>%
            group_by(EmpDepartment) %>%
            dplyr::summarize(count = n())

plot_ly(dept_pie, labels = ~EmpDepartment, values = ~count, type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent',
        insidetextfont = list(color = 'black'),
        hoverinfo = 'text',
        text = ~paste(count),
        marker = list(colors = colors,
                      line = list(color = '#FFFFFF', width = 1)),
                      #The 'pull' attribute can also be used to create space between the sectors
        showlegend = FALSE) %>%
  layout(title = 'Employee distribution within an organization',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

# iii. Donut Chart

hr_df %>%
  group_by(EmpDepartment) %>%
  dplyr::summarize(count = n()) %>%
  plot_ly(labels = ~EmpDepartment, values = ~count) %>%
  add_pie(hole = 0.6) %>%
  layout(title = "Employee distributed among the Organization",  showlegend = F,
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))


# Normal Pie Chart:

# hr_df %>%
#   count(EmpDepartment) %>%
#   arrange(desc(EmpDepartment)) %>%
#   mutate(prop = round(n * 100 / sum(n), 1),
#          lab.ypos = cumsum(prop) - 0.5  *prop) %>% 
#   ggplot(aes(x="", y=prop, fill=EmpDepartment)) + 
#   geom_bar(stat="identity", width=1)+
#   coord_polar("y", start=0) +
#   theme_void() +
#   labs(title = "Employee distribution within an organization")+
#   theme(plot.title = element_text(size = 15, hjust = 0.5, color = "red", face="bold.italic"))+
#   geom_text_repel(aes(label = paste0(round(prop), "%")), position = position_stack(vjust = 0.9), size = 4)+
#   geom_text_repel(aes(label = EmpDepartment), size = 8, position = position_stack(vjust = 0.1), angle = 80, hjust = 0.5)+
#   scale_fill_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE", "#8B8682", "#CD96CD")) +
#   scale_color_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE", "#8B8682", "#CD96CD"))+
#   theme(legend.position = "right",
#         legend.direction = "horizontal",
#         legend.box = "horizontal",
#         legend.title=element_blank(),
#         legend.text=element_text(size=8))
```

Three biggest Department are: Sales, Development & R&D. Distribution are 

1. Sales : 31.1%
2. Development : 30.6% 
3. R&D : 28.6%
4. HR : 4.5%
5. Finance : 4.08%
6. DS : 1.67 % 

## <span style="color:red">EmpDepartment & Gender</span>

- A.Workforce breakdown among different Department
- B.Workforce breakdown among different Department by Gender
- C.EmpDepartment and Educational_Background
- D.EmpDepartment and Educational_Levels

```{r}
# A. Workforce breakdown among different Department:

p2 <- hr_df %>% 
       group_by(EmpDepartment, Attrition) %>% 
       dplyr::summarise(count=n()) %>%
       mutate(pct = round(prop.table(count),2)*100) %>% 
       ggplot(aes(x=EmpDepartment, y=pct, fill=Attrition, color =Attrition)) +
       geom_bar(stat="identity", position=position_stack()) +
       coord_flip()+
       theme_classic() +
       labs(title="By Attrition",x="Department \n", y="Percentage (%)")+
       theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
       theme(axis.title.x = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_text(aes(x= EmpDepartment,label = paste0(pct,"%")),color = "black", position = position_stack(vjust = .5), size = 2.2)+
       scale_fill_manual(values=c("springgreen","tomato")) +
       scale_color_manual(values=c("springgreen","tomato"))+
       theme(legend.text=element_text(size=8),
             legend.position = "none",
             legend.box = "horizontal",
             legend.title=element_blank())

# B. Workforce breakdown among different Department by Gender
p3 <- hr_df %>% 
       group_by(EmpDepartment, Gender) %>% 
       dplyr::summarise(count=n()) %>%
       mutate(pct = round(prop.table(count),2)*100) %>% 
       ggplot(aes(x=EmpDepartment, y=pct, fill=Gender, color = Gender)) +
       geom_bar(stat="identity", position=position_stack()) +
       coord_flip()+
       theme_classic() +
       labs(title="By Gender",x="Department \n", y="Percentage (%)")+
       theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
       theme(axis.title.x = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_text(aes(x= EmpDepartment,label = paste0(pct,"%")),color = "black", position = position_stack(vjust = .5), size = 2.2)+
       scale_fill_manual(values=c("hotpink", "deep sky blue")) +
       theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
       theme(legend.text=element_text(size=8),
             legend.position = "none",
             legend.box = "horizontal",
             legend.title=element_blank())

# C. EmpDepartment and Educational_Background
p4 <- hr_df %>% 
       group_by(EmpDepartment, EducationBackground) %>% 
       dplyr::summarise(count = n()) %>% 
       mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
       ggplot(aes(x = EmpDepartment, y = gender_pct,fill = EducationBackground, color=EducationBackground))+
       geom_bar(stat = "identity",position = position_stack())+
       coord_flip()+
       theme_classic()+
       labs(title="By Education Background.",
              x = "Department \n",
              y = "Percentage(%)") + 
       theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
       theme(axis.title.x = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_text(aes(x= EmpDepartment, label = paste0(gender_pct,"%")),
              hjust =-1, position = position_stack(vjust = .5), size = 2.2, color = 'black', fontface = 'bold')+
       theme(legend.text=element_text(size=8),
             legend.key.size = unit(0.15, "cm"),
             legend.position = "bottom",
             legend.box = "horizontal",
             legend.title=element_blank())
 
# D. EmpDepartment and Educational_Levels
p5 <- hr_df %>% 
      group_by(EmpDepartment, Educational_Levels) %>% 
      dplyr::summarise(count = n()) %>% 
      mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
      ggplot(aes(x = EmpDepartment, y = gender_pct,fill =Educational_Levels, color=Educational_Levels))+
      geom_bar(stat = "identity",position = position_stack())+
      coord_flip()+
      theme_classic()+
      labs(title="By Education level",
              x = "Department \n",
              y = "Percentage(%)") + 
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.y = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_text(aes(x= EmpDepartment, label = paste0(gender_pct,"%")),
             hjust =-1, position = position_stack(vjust = .5), size = 2.2, color = 'black', fontface = 'bold')+
      scale_fill_manual(values=c("#8B8B00", "#36648B", "#9400D3", "#54FF9F", "#FFEBCD"))+
      scale_color_manual(values=c("#8B8B00", "#36648B", "#9400D3", "#54FF9F", "#FFEBCD"))+
      theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
      theme(legend.text=element_text(size=8),
            legend.key.size = unit(0.1, "cm"),
            legend.position = "bottom",
            legend.box = "horizontal",
            legend.title=element_blank())

title <- ggdraw() + draw_label("Workforce breakdown across Department", fontface='bold.italic', size= 14, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p2,p3,p4,p5, nrow = 2,labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1, 1))
```


**A**

- More Employee working in Sales department tends to leave compare to rest.
- HR being the second.

**B**

- It seems like most of the department is splitted between 60% Male population and 40% Female population except Human Resource department where there are 70% Male and 30% Female population.

**C**

- Major Dominant in all Departments is Life Science Field except in Human Resource department where backgorund field knowledge is Human Resource and Sales department where the person need to have Marketing background knowledge.

**D**

- In all field major Education level is Bachelor Degree.
- Except Data Science where major education level is College Degree(35%).
- Finance: Compare to all other departments Finance have 10% Employee with PhD degree.
- R&D: R&D have more Master Degree Employee comapare to other departments
- HR and Finance: HR and Finance have 43% population with bachelor degree.
- HR: HR has less employee with no college degree compare to rest of department.

#<span style="color:red">**Employee Job Role**</span>

```{r}

# A .Daily Hourly Rates by Job Role & Attrition Status: 
p6 <- hr_df %>% 
      select(EmpJobRole, Attrition,EmpHourlyRate) %>% 
      group_by(Attrition, EmpJobRole) %>%
      ggplot(aes(x=EmpJobRole, y=EmpHourlyRate, color=Attrition)) + 
      stat_summary(fun.y=mean, fun.ymin = min, fun.ymax = max) +
      geom_hline(aes(yintercept=mean(EmpHourlyRate)),color="darkblue", linetype="dashed", size=1) +
      coord_flip() +
      theme_minimal()+
      labs(title="Attrition", y = "HourlyRate", x = "Job Role")+
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.text.x = element_text(angle = 90))+
      scale_color_manual(values=c("springgreen","tomato")) +
      theme(legend.position="none")

# B. Employee Job Role Count - 1st way : pyramid chart

p7 <- hr_df %>% 
      group_by(EmpJobRole,Gender) %>% 
      dplyr::summarise(count = n()) %>% 
      arrange(desc(count)) %>% 
      ggplot(aes(x=as.factor(EmpJobRole),fill=Gender)) + 
      geom_bar(data=subset(hr_df,Gender == "Female")) + 
      geom_bar(data=subset(hr_df,Gender == "Male"),aes(y=..count..*(-1))) + 
      coord_flip()+
      theme_minimal()+
      labs(x ="Job Role \n",
           y ="Count",
           title="By Gender")+
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      scale_y_continuous(breaks=seq(-200,50,25),labels=abs(seq(-200,50,25))) + 
      scale_fill_manual(values=c("hotpink","skyblue")) +  
      scale_color_manual(values=c("hotpink","skyblue")) + 
      theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
      theme(legend.position = "none")


# C . Tree Map by Employee Job Role.
p8 <- hr_df %>%
      select(EmpJobRole) %>%
      group_by(EmpJobRole) %>% 
      dplyr::summarize(amount=n()) %>%
      ggplot(aes(area=amount, fill=EmpJobRole, label=EmpJobRole)) + 
      geom_treemap() +
      labs(title = "",fill = "JobRole")+
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_treemap_text(grow = T, reflow = T, colour = "black") +
      scale_fill_manual(values = c(brewer.pal(name="Dark2", n = 8), brewer.pal(name="Paired", n = 12)))+
      theme(legend.position = "none") 

# D . Employee Job Role Count - 2nd way : Break down by Gender

p9 <- hr_df %>% 
      group_by(EmpJobRole,Gender) %>% 
      dplyr::summarise(count = n()) %>% 
      arrange(desc(count)) %>% 
      ggplot(aes(x =reorder(EmpJobRole,count), y = count, fill = Gender, color=Gender))+
      geom_bar(stat = "identity")+
      coord_flip()+
      theme_minimal()+
      labs(title="By Gender",
            x = "JobRole \n",
            y = "Count") + 
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_text(aes(x= reorder(EmpJobRole,count), label = paste0(count, sep = "")),hjust =1,position = position_stack(vjust =0.5), size = 2, color = 'black', fontface = 'bold')+
      theme(panel.grid.major = element_line("white"),panel.grid.minor = element_line("white"))+ 
      scale_fill_manual(values=c("hotpink","deep sky blue")) +
      scale_color_manual(values=c("hotpink","deep sky blue")) + 
      theme(legend.position="none")

title <- ggdraw() + draw_label("Workforce breakdown across Department", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p6,p7,p8,p9, nrow = 2, labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1, 1))
```

**A**

- We can see how does the Hourly Rate and Job Role impacts the attrition Rate.

**B,C,D**

- Sales Executive and Developer are two pillars of whole organization. There are more Male population compare to Female Population in both field as it is clear from all three charts.
- Attrition of Job Role Employee by Hourly Rate. We will dig into analysis part later down below.

```{r}
# E. Proportion of Hourly Rate for the specific Job Role
p10 <- hr_df %>% 
      group_by(EmpJobRole,hourly_bin) %>% 
      dplyr::summarise(count = n()) %>% 
      mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
      ggplot(aes(x = EmpJobRole, y = gender_pct,fill =hourly_bin, color=hourly_bin))+
      geom_bar(stat = "identity",position = position_stack())+
      coord_flip()+
      theme_classic()+
      labs( x = "Education Level \n",
            y = "Percentage(%)") + 
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(x= EmpJobRole, label = paste0(gender_pct,"%")),
             hjust =0.5, position = position_stack(vjust = .5), size = 2.2, color = 'black', fontface = 'bold')+
      theme(legend.text=element_text(size=12),
            legend.position = "right",
            legend.box = "horizontal",
            legend.spacing.x = unit(1.0, 'cm'),
            legend.key.size = unit(1.2, "cm"), # Legend Key Size.
            legend.title=element_text(size = 12))

title <- ggdraw() + draw_label("Proportion of Hourly Rate for the specific Job Role", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p10, nrow = 1, labels = "E") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1))
```

**E**

- Except Technical Architect and Senior Manager in R&D all other JobRole Employee could make 90-100$ an hour(colored PinK label).
- 22% Manager R&D make almost $ 90-100 an hour.
- Technical Architecture has less layers of Hourly distribution (Only 4 )
- Most of the Technical Architect fall between 
  - $30-$39 : 29%
  - $40-$49 : 29%
  - $50-$59 : 14%
  - $70-$79 : 29%
  
- Senior Manager R&D Payscale lies mostly between $60-$69 about 33%.
- Most of the business Analysr make about $50-$59 an hour about 31%
- Research Director Starting hourly Rate is $40-$$49.
- Only 10% Data Scientist make $90-$100 an hour.

```{r}
# F . Job Role by Age

p11 <- ggplot(hr_df, aes(x =Age , y = EmpJobRole, fill = EmpDepartment)) +
       geom_density_ridges() +
       theme_economist() + 
       labs(x ="Age",
           y ="Job Role \n") + 
       theme(plot.title = element_text(size = 9, hjust = 0.5, color = "red", face="bold.italic"))+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.text.x=element_text(size=5))+
       theme(legend.text=element_text(size=6),
            legend.position = "left",
            legend.box = "horizontal",
            legend.title=element_blank())

# G. Age | Employee Job Role | Gender

p12 <- ggplot(hr_df, aes(x =Age , y = EmpJobRole, fill = Gender)) +
       geom_density_ridges() +
       theme_economist() + 
       labs(x ="Age",
            y ="Employee Job Role \n ") + 
      theme(plot.title = element_text(size = 12, hjust = 0.5,color = "red",face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      scale_fill_manual(values=c("hotpink","deep sky blue")) + 
      theme(axis.text.y=element_blank(),
            axis.title.y=element_blank(),
            axis.ticks.y=element_blank())+
      theme(legend.position="none")

title <- ggdraw() + draw_label("Job Role & Gender Age Distribution", fontface='bold', size= 12, colour = "red")
bottom_row <- suppressMessages(plot_grid(p11,p12,nrow = 1, labels = c("F", "G")) )
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**F & G**

- Business Analyst and Healthcare Reprsentative Job Role are prefered to Younger Female Candidate.
- Research Director before age 40 goes mostly to Females than to Males.
- Technical Lead, Senior Manager R&D , Senior Developer, Manufacturing Director have more Senior Female than Senior Male.
- Delivery Managers before Age 40 goes to Male than to Female.

```{r}
# Age vs. Job Role  vs. Attrition
p13 <- hr_df %>% 
  select(EmpJobRole,Age,Attrition) %>% 
  group_by(EmpJobRole, Attrition) %>%
  dplyr::summarize(avg.age=mean(Age)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg.age)) +
  geom_line(aes(group=Attrition), color="purple", linetype="dashed") + 
  geom_point(aes(color=Attrition), size=3) + 
  coord_flip()+
  theme_minimal() + 
  labs(title="Avg.Age", y="Avg.Age", x="Job Role") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.text.x=element_text(angle=90),plot.background=element_rect(fill="#FFF1E0")) +
  scale_color_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")+
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"))

# Hourly Rate vs. Job Role  vs. Attrition
p14 <- hr_df %>% 
  select(EmpHourlyRate, EmpJobRole, Attrition) %>% 
  group_by(EmpJobRole, Attrition) %>%
  dplyr::summarize(avg.rate=mean(EmpHourlyRate)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg.rate)) +
  geom_line(aes(group=Attrition), color="purple", linetype="dashed") + 
  geom_point(aes(color=Attrition), size=3) + 
  coord_flip()+
  theme_minimal() + 
  labs(title="Hourly ($)", y="Avg.HourlyRate ", x="") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.text.x=element_text(angle=90),plot.background=element_rect(fill="#FFF1E0")) +
  theme(axis.text.y=element_blank())+
  scale_color_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")+
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"))

title <- ggdraw() + draw_label("Job Role & Attrition based on Age and Hourly Rate", fontface='bold', size= 12, colour = "red")
bottom_row <- suppressMessages(plot_grid(p13,p14,nrow = 1,labels = c("H", "I"))) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "","", "C"), rel_heights = c(0.05, 0.5, 0.5),scale = 0.97)
```

**H**

- We can see most of the employee around average age 30-35 are attributed more regardless of Job Role.
- Technical Lead , Sales Executive and Healthcare Representative have same average age of attrition.
- Manufacturing Director, Manager and Business Analyst also have same age of attrition.

**I**

- We could spot the average pay difference between Employee who tends to leave the company and who stays.
- The average difference for each some jobs are pretty close whereas for some jobs there is huge difference.

```{r}
p15 <- hr_df %>% 
      group_by(EmpJobRole,Educational_Levels) %>% 
      dplyr::summarise(count = n()) %>% 
      mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
      ggplot(aes(x = EmpJobRole, y = gender_pct,fill =Educational_Levels, color=Educational_Levels))+
      geom_bar(stat = "identity",position = position_stack())+
      coord_flip()+
      theme_classic()+
      labs(x = "Education Level \n",
           y = "Percentage(%)") + 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(x= EmpJobRole, label = paste0(gender_pct,"%")),
             hjust =0.5, position = position_stack(vjust = .5), size = 2.2, color = 'black', fontface = 'bold')+
      theme(legend.text=element_text(size=8),
            legend.position = "right",
            legend.box = "horizontal",
            legend.spacing.x = unit(1, 'cm'),
            legend.key.size = unit(1, "cm"), # Legend Key Size.
            legend.title=element_text(size = 12))

title <- ggdraw() + draw_label("Education levels distributed among the job Role.", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p15, nrow = 1, labels = "J") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1))
```

**J**

PhD:
- We can also Not every Job Role requires PhD so the Education background is limited according to Job Role.

Master Degree:
- Senior Manager R&D have more Master degree.

Bacehlor Degree: 
- Almsot 53% Research Director have Bacehlor Degree.

College Degree:
- Most of Data Scientist have only College Degree almost 35%

No College Degree:
- 28% Sales Representative have no College Degree.

```{r}
p16 <- hr_df %>% 
  select(EmpJobRole,EmpHourlyRate,Gender) %>% 
  group_by(EmpJobRole, Gender) %>%
  dplyr::summarize(avg_inc=mean(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg_inc, fill =Gender )) + 
  geom_bar(stat="identity", position=position_stack()) + 
  coord_flip()+
  theme_solarized() +
  labs(x="Department \n",
       y="Mean Hourly Rate") + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(x = EmpJobRole, label = paste0("$ ",round(avg_inc,2))),hjust=0.5, vjust=0.5, size = 2.5, color =   'midnightblue',fontface = 'bold', position=position_stack())+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
   scale_fill_manual(values=c("hotpink","deep sky blue"))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Job Role Mean Hourly Rate by Gender.", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p16, nrow = 1, labels = "K") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1))
```

**K**

- In Some Job Role Female Tends to make more money than Male do.
- In Some the difference is Minimal and in some there is huge difference which could be because of Education levels and which could be becuase of Experience in Years.


#<span style="color:red">**Education level**</span>

i. Education level by Gender
ii. Education level & Attrition.
iii. Education level & Gender.
iv. Education level, Attrition and Department

```{r}
# i. Education level by Gender
p17 <- hr_df %>%
      group_by(Educational_Levels) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ungroup() %>% 
      arrange(pct) %>% 
      ggplot(aes(x=Educational_Levels, y=pct, fill=Educational_Levels, color=Educational_Levels)) + 
      geom_bar(stat="identity") +
      coord_flip() + 
      theme_economist() + 
      labs(x="Education Level \n", y="Percentage(%)", title="Total %")+  
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label_repel(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 3)+ 
      geom_label_repel(aes(label=Count), color = "black", fontface = "bold", y= 0.1, hjust = 0, vjust =.5, size =1.5)+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none",axis.text.x = element_blank(),
            plot.background=element_rect(fill="lightcyan"))

p18 <- hr_df %>%
      group_by(Educational_Levels,Gender) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ungroup() %>% 
      arrange(desc(Educational_Levels),-pct) %>% 
      ggplot(aes(x=fct_reorder(Educational_Levels,pct), y=pct, fill=Educational_Levels, color=Educational_Levels)) + 
      geom_bar(stat="identity") +
      coord_flip() + 
      facet_wrap(~Gender)+
      theme_economist() + 
      labs(x="Education Level \n", y="Percentage(%)")+  
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label_repel(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 3)+ 
      geom_label_repel(aes(label=Count), color = "black", fontface = "bold", y= 0.1, hjust = 0, vjust =.5, size =1.5)+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
    theme(axis.text.x=element_blank(),axis.text.y=element_blank(), axis.title.y = element_blank())+
      theme(legend.position="none",
            plot.background=element_rect(fill="lightcyan"))

p19 <- hr_df %>%
      select(Educational_Levels, Attrition) %>%
      group_by(Educational_Levels,Attrition) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ungroup() %>% 
      arrange(desc(Educational_Levels), -pct) %>% 
      ggplot(aes(x=fct_reorder(Educational_Levels,pct), y=pct, fill=Attrition, color=Attrition)) + 
      geom_bar(stat="identity") +
      facet_wrap(~Attrition) + 
      coord_flip() + 
      theme_economist() + 
      labs(x="Education Level \n", y="Percentage(%)")+  
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label_repel(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 3)+ 
      geom_label_repel(aes(label=Count), color = "black", fontface = "bold", y= 0.1, hjust = 0, vjust =.5, size =1.5)+
      scale_fill_manual(values=c("springgreen","tomato")) + 
      scale_color_manual(values=c("springgreen","tomato")) + 
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(axis.text.x=element_blank(),axis.text.y=element_blank(),axis.title.y = element_blank())+
      theme(legend.position="none",
            plot.background=element_rect(fill="lightcyan"))

title <- ggdraw() + draw_label("Education Level Distribution", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p17,p18,p19, ncol = 3, labels = "AUTO")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**A**

As we can see that Most of our workforce have Bachelor degree i.e 37% followed by Master degree i.e 27%. As we aspect Phd are very less comprising 4%.

**B**

when we break it down by Gender it seems like there are equal number of Phd candidates.42 Employee have done Phd and when we even break it down by gender it seems like we have equal number of Male and Female Employee.

**C**

Employee with no college degree seems to leave the company compare to rest of the education field either could be for getting higher education degreee or for lack of growth inside the organization.


```{r}
p20 <- hr_df %>% 
      group_by(Educational_Levels,hourly_bin) %>% 
      dplyr::summarise(count = n()) %>% 
      mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
      ggplot(aes(x = Educational_Levels, y = gender_pct,fill =hourly_bin, color=hourly_bin))+
      geom_bar(stat = "identity",position = position_stack())+
      coord_flip()+
      theme_classic()+
      labs(title="By Hourly ",
              x = "Education Level \n",
              y = "Percentage(%)") + 
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(x= Educational_Levels, label = paste0(gender_pct,"%")),
             hjust =0.5, position = position_stack(vjust = .5), size = 2.2, color = 'black', fontface = 'bold')+
      theme(legend.text=element_text(size=12),
            legend.key.size = unit(0.5, "cm"),
            legend.position = "right",
            legend.box = "horizontal",
            legend.title=element_text(size =8))


# Education level distribution according to the age group
p21 <- hr_df %>%
      group_by(Educational_Levels,Age_bin) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ungroup() %>% 
      arrange(desc(Educational_Levels),-pct) %>% 
      ggplot(aes(x=Educational_Levels, y=pct, fill=Age_bin, color=Age_bin)) + 
      geom_bar(stat="identity",position = position_stack()) +
      coord_flip() + 
      theme_classic() + 
      labs(x="Age_bin \n", y="Percentage(%)", title="By Age bin group")+  
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 2.2,position = position_stack(vjust = 0.5))+ 
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.text=element_text(size=12),
            legend.key.size = unit(0.5, "cm"),
            legend.position = "right",
            legend.box = "horizontal",
            legend.title=element_text(size =10))

title <- ggdraw() + draw_label("Workforce breakdown based on their Education Level", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p20,p21, nrow = 2, labels = c("D", "E")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1, 1))

```

**D**

- Education level doesn't play any role in How much Money you make. Education level is independent of How much money you could make.


```{r}
p22 <- hr_df %>%
      group_by(Educational_Levels,MaritalStatus) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ungroup() %>% 
      arrange(desc(Educational_Levels),-pct) %>% 
      ggplot(aes(x=Educational_Levels, y=pct, fill=MaritalStatus, color=MaritalStatus)) + 
      geom_bar(stat="identity", position = position_stack()) +
      coord_flip() + 
      theme_economist() + 
      labs(x="Educational_Levels \n", y="Percentage(%)", title="By Martial Status")+  
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 2.2,position = position_stack(vjust = 0.5))+ 
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.text=element_text(size=8),
            legend.key.size = unit(0.1, "cm"),
            legend.position = "top",
            legend.box = "horizontal",
            legend.title=element_blank())

# Education level distribution according to the age group
p23 <- hr_df %>%
      group_by(Educational_Levels,Generation) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ungroup() %>% 
      arrange(desc(Educational_Levels),-pct) %>% 
      ggplot(aes(x=Educational_Levels, y=pct, fill=Generation, color=Generation)) + 
      geom_bar(stat="identity",position = position_stack()) +
      coord_flip() + 
      theme_economist() + 
      labs(x="Educational_Levels \n", y="Percentage(%)", title="By Generation")+  
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 2.5,position = position_stack(vjust = 0.5))+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
  theme(legend.text=element_text(size=8),
            legend.key.size = unit(0.1, "cm"),
            legend.position = "top",
            legend.box = "horizontal",
            legend.title=element_blank())

title <- ggdraw() + draw_label("Workforce breakdown based on their Education Level", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p22,p23, ncol = 2, labels = c("F","G")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**E, F & G**

- Phd:
  - 7% Employee are aged between 20-30.
  - 45% Employee Aged between 30-40.
  - 52% Married Employee have PhD.
  
- Master Degree:
  - 10 % Employee are aged between 20-30
  - 56 % Employee are aged between 30-40.
  - 45 % Married Employee have Master Degree.

- Bachelor Degree:
  - 3 % have Employee either have already completed or have Bachelor degree under Age 20.
  - 38% Employee are aged between 30-40
  - 45 % Married Employee have Bachelor Degree.
  

- College Degree
    - 2% are Aged Under 20.
    - 40 % Employee are aged between 30-40
    - 26% Married Employee have College Degree.
    
    
- No College Degree:
  - 4% Employee are aged under 20
  - 4% Employee are aged 50-60
  - 48% Employee between age 20-30 
  - 49% Married Employee have No College Degree.
  - 73% Millenials have No College Degree.
  - 3% Baby Boomers have No colllege Degree.
  - 1 %  Silent Gen who have No college Degree.
  
  
```{r}

# i. Education level, Attrition & Department
p24 <- hr_df %>%
      select(Educational_Levels, EmpDepartment,Attrition) %>%
      group_by(Educational_Levels, EmpDepartment,Attrition) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ggplot(aes(x=fct_reorder(Educational_Levels,pct), y=pct, fill=Attrition, color=Attrition)) + 
      geom_bar(stat="identity", position = position_stack()) +
      coord_flip() + 
      facet_grid(~EmpDepartment) + 
      theme_economist() +
      labs(x="Education Level \n", y="Percentage(%)")+    
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label_repel(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 2)+ 
      scale_fill_manual(values=c("springgreen","tomato")) + 
      scale_color_manual(values=c("springgreen","tomato")) + 
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none", plot.background=element_rect(fill="lightcyan"))

title <- ggdraw() + draw_label("Attrition across Department based on Education Levels", fontface='bold.italic', size= 12, colour = "red", hjust = 0.5, vjust = 0.5)
bottom_row <- plot_grid(p24, nrow = 1, labels = "H") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))

```

**H**

- Phd:
  - 33% Attrition in Human Resource Department.
  - 0% Attrition in Finance.
  
- Master Degree:
  - 25 % Attrition in Data Science
  - 9 % Attrition in Finance.
  
- Bachelor Degree:
  - 19% Attrition in Sales Department.
  - 5% Attrition in Finance Department.
  
- College Degree:
  - 22% Attrition in Sales Department.
  - 0% Attrition in Data Science.
  
- No College Degree:
  - 50 % Attrition in Data Science Department.
  - 0 % Attrition in Human Resource.
  
#<span style="color:red">**Age**</span>

Lets look at the Age distribution in our datasets.

i. Density Age Distribution
ii. Barplot Age Distribution 
iii. Mean Age Distribution
iv. Percentage of Male & Female  Distribution

- Highest Age of Employment in the organisation is Age: 60.


```{r}
# Max Age
hr_df[hr_df$Age == max(hr_df$Age), ] %>% kable(caption = "This is the Maximum Age_bin distribution",booktabs = T)%>% 
  kable_styling("striped", full_width = F) %>% scroll_box(width = "500px", height = "200px")

# Min age
hr_df[hr_df$Age == min(hr_df$Age), ] %>% kable(caption = "This is the Minimum Age_bin distribution",booktabs = T)%>% 
  kable_styling("striped", full_width = F) %>% scroll_box(width = "500px", height = "200px")
```

**Oldest Employee**

- 3 Employees
- We have Sales Executive who is at Age 60 (Retirment) who is still Single and makes $84 an hour. 

**Youngest Employee**

- 8 Newbies
- We have 18 year old Female in R&D Department who is Manager and makes $97 an hour.

```{r,warning= FALSE, message=FALSE}

# Overall Age distribution of our data.
avg_age <- hr_df %>% summarise(avg=mean(Age))

# Overall Age distribution of Male and Female Population
gender_age <- hr_df %>% group_by(Gender) %>%  summarise(avg=mean(Age))

#i. Density Age Distribution
p25 <- ggplot(hr_df, aes(x = Age))+ 
  geom_histogram(aes(y = ..density..,color = Gender,fill = Gender),alpha = 0.4,position = "identity") + 
  geom_density(aes(color = Gender), size =1)+
  theme_minimal()+
  labs(title="Density Age Distribution",
        x = "Age",
        y = "Density") +
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  scale_fill_manual(values=c("hotpink","deep sky blue")) +  
  scale_color_manual(values=c("hotpink","deep sky blue")) +
  theme(legend.position = "none")

# ii. Barplot Age Distribution
p26 <- ggplot(hr_df, aes(x = Age))+ 
    geom_histogram(aes(color = Gender), fill = "white", alpha = 0.6, position = "dodge", bins = 50) +
    geom_vline(aes(xintercept = mean(Age)), linetype = "dashed")+
    theme_minimal()+
    labs(title="Barplot Age Distribution",
            x = "Age",
            y = "Count") + 
    theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
    theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    annotate("text", label = "Avg_Mean = 36.92 Yrs", x = 50, y = 35, color = "blue",size = 3)+
    scale_fill_manual(values=c("hotpink","deep sky blue")) +  # inside color of the box
    scale_color_manual(values=c("hotpink","deep sky blue")) +
    theme(legend.position = "none")

mu <- hr_df %>% group_by(Gender) %>% summarize(grp_mean = mean(Age))

# iii. Mean Age Distribution
p27<- ggplot(hr_df, aes(x = Age))+ 
      geom_density(aes(fill = Gender), alpha = 0.4) +
      geom_vline(data = mu, aes(xintercept = grp_mean, color = Gender), linetype = "dashed")+
      theme_minimal()+
      labs(title="Mean Age Distribution",
              x ="Age",
              y ="Density") + 
    theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
    theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    annotate("text",label = "F_Mean = 37.36 Yrs", x = 50, y = 0.042, color = "hotpink",size = 3)+
    annotate("text", label = "M_Mean = 36.62 Yrs", x = 50, y = 0.035, color = "deep sky blue", size = 3)+
    scale_fill_manual(values=c("hotpink","deep sky blue")) +  # inside color of the box
    scale_color_manual(values=c("hotpink","deep sky blue")) +
    theme(legend.position = "none")
    
# pie chart representing What % of our data is male and Female
p28 <- hr_df %>%
    count(Gender) %>%
    arrange(desc(Gender)) %>%
    mutate(prop = round(n * 100 / sum(n), 1),
           lab.ypos = cumsum(prop) - 0.5  *prop) %>% 
    ggplot(aes(x = "",y = prop,fill = Gender)) +
    geom_bar(width = 1, stat = "identity", color = "black") +
    coord_polar("y", start = 0,direction = -1) +
    theme_void()+
    labs(title="Percentage of Male & \n Female  Distribution", hjust = 0.5) +
    theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
    theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    geom_text(aes(y = lab.ypos, label = prop), color = "black") +
    scale_fill_manual(values=c("hotpink","deep sky blue")) + 
    scale_color_manual(values=c("hotpink","deep sky blue")) + 
    theme(legend.position = "none")

title <- ggdraw() + draw_label("Age Disribution", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p25,p26,p27,p28, nrow = 2,labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

- Age is Normal Distributed.
- In our Datasets there are 39.6% Female poulation and 60.4% Male Population.
- Overall Average Age of our population datasets is 36.92
- Average Age of Male Population is 36.62
- Average Age of Female Population is 37.36

#<span style="color:red">**Age_bin**</span>


Age column has been spread from  Minimum Age 18 to max Age 60. Lets bin all of them into decades. 
By doing so we will be able to reduce the noise and outliers and be more focused on inights without being baised. 

i. Age distribution by Gender
ii. Age distribution by Department


```{r}
gender_age <- hr_df %>% group_by(Gender) %>% summarise(avg=mean(Age)) # Average Age by Gender

avg_age <- hr_df %>% summarise(avg=mean(Age)) # Overall Average Age

mean_age_dept <- hr_df %>% group_by(EmpDepartment, Gender) %>% dplyr::summarise(count = n()) %>%  arrange(count) # Avergae Age by Department & Gender

# i. Lets Calculate Average Age for Male and Female
p29 <- hr_df %>% 
        select(Gender, Age) %>% 
        group_by(Gender, Age) %>% 
        dplyr::summarise(avg=mean(Age)) %>% data.frame() %>% 
        ggplot(aes(Gender,Age, fill = Gender))+
        geom_boxplot()+
        geom_hline(yintercept = mean(hr_df$Age), col = "red",linetype="dashed",size=1.5)+
        theme_gdocs()+
        labs(x= "Gender", y = "Age \n")+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        annotate("text", label = "Mean = \n 37.36 Years", x = 1, y = 45, color = "black", size=2.5)+
        annotate("text", label = "Mean = \n 36.62 Years", x = 2, y = 35, color = "black",size=2.5)+
        annotate("text", label = "Mean = \n 36.92 Years", x = 1.5, y = 25, color = "red",size=2.5)+
        scale_fill_manual(values=c("hotpink","deep sky blue")) + 
        scale_color_manual(values=c("hotpink","deep sky blue")) +
        theme(legend.position="none")

#ii. Average Age distribution by Gender across between different Age Group.
p30 <- hr_df %>% 
        group_by(Gender,Age_bin) %>% 
        summarise(count = n()) %>% 
        mutate(pct = round(prop.table(count),2)*100) %>% 
        ggplot(aes(x = Age_bin, y = pct,fill = Gender))+
        geom_bar(stat = "identity", color = "black",position = position_dodge())+
        theme_calc()+
        labs(x= "Age_bin", y = "percentage \n")+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label = paste0(pct,"%")), vjust = 1.2, color = "black", position = position_dodge(0.9), size = 2.2)+
        theme(axis.text.x = element_text(angle=45, vjust=0.4)) +
        scale_fill_manual(values=c("hotpink","deep sky blue")) + 
        scale_color_manual(values=c("hotpink","deep sky blue"))+
        theme(legend.position = "none")

# iii. Age Distribution  & Gender.
p31 <- ggplot(data=hr_df,aes(x=as.factor(Age),fill=Gender)) + 
       geom_bar(data=subset(hr_df,Gender=="Female")) + 
       geom_bar(data=subset(hr_df,Gender=="Male"),aes(y=..count..*(-1))) +
       coord_flip()+
       theme_calc()+
       labs(x ="Age \n",y ="count") +
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       scale_y_continuous(breaks=seq(-40,40,10),labels=abs(seq(-40,40,10))) + 
       scale_fill_manual(values=c("hotpink","deep sky blue")) + 
       scale_color_manual(values=c("hotpink","deep sky blue")) +  
       theme(legend.position = "none") 

title <- ggdraw() + draw_label("Age Disribution by Gender", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p29,p30,p31,nrow = 1,labels = "AUTO") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))

```


**A, B & C**

Our datasets when we broke down by the agebin group, it seems like we have balance datasets between male and Female across all age groups.

```{r}
# iv.boxplot Gender distribution :
p32 <- ggplot(hr_df, aes(x=EmpDepartment, y=Age,color= Gender)) +
       geom_boxplot(fill='#A4A4A4')+
       stat_summary(fun.y = min, color = "dark green", geom = "point", size = 3) +
       stat_summary(fun.y = max, color = "black", geom = "point", size = 3)+
       stat_summary(fun.data = mean_cl_normal, geom = "crossbar",width = .3, color = "blue")+
       geom_hline(yintercept = 36.91, col = "red")+
       theme_pander()+
       labs(x = "Department", y = "Age \n")+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.text.x = element_text(angle=45, vjust=0.4)) +
       scale_fill_manual(values=c("hotpink","deep sky blue")) +  # inside color of the box
       scale_color_manual(values=c("hotpink","deep sky blue")) +
       theme(legend.position = "none")

#v. Density Plot across Department.
p33 <- hr_df %>%
       select(EmpDepartment, Age) %>%
       group_by(EmpDepartment) %>% 
       ggplot(aes(x=Age)) + 
       geom_density(aes(fill=EmpDepartment), alpha=0.8, show.legend=FALSE) +
       facet_wrap(~EmpDepartment) +
       theme_dark()+
       labs(x = "Age", y = "density \n")+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_vline(aes(xintercept=mean(Age)),color="red", linetype="dashed", size=1) +
       scale_fill_manual(values=c("#B4EC6E", "#B86464","#0000FF", "#44154A","#262427", "#64E5DE"))+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))

title <- ggdraw() + draw_label("Age Disribution by Department", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p32,p33,nrow = 1, labels = c("D", "E")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**D**

- In Finance we can see there is difference between Male and Female Age Group.
- We can see Male Outliers in Sales and Females Outliers in Development Department.
- In Data Science Department also we can see some difference between male and Female Age Group.
- There is less difference in R&D and HR departement between Male and Female Age.

**E**

- The peaks of a Density Plot help display where values are concentrated over the interval.
- we can illustrate how the distribution of a Age change over time.
- In sales we can see lot of Young People followed by Development and then by R & D before their mean age.

```{r}
# vi. Age Distribution fill by Attrition count
p34 <- ggplot(data=hr_df,aes(x=as.factor(Age),fill=Attrition)) + 
       geom_bar(data=subset(hr_df,Attrition=="Yes")) + 
       geom_bar(data=subset(hr_df,Attrition=="No"),aes(y=..count..*(-1))) + 
       theme_economist()+
       labs(x = "Age",
            y = "Attrition")+
       labs(x = "Age", y = "Attrition Count \n")+
       theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       scale_y_continuous(breaks=seq(-50,50,15),labels=abs(seq(-50,50,15))) + 
       scale_fill_manual(values=c("springgreen","tomato")) + 
       scale_color_manual(values=c("springgreen","tomato")) +  
       theme(axis.text.x = element_text(angle = 90))+
       theme(legend.position = "none")

title <- ggdraw() + draw_label("Age Disribution Attrition", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p34,nrow = 1, labels = "F") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**F**

- We can see Age and Attrition of the Employee. Seems like Normal Distribution in both who leaves the company and who stays throughout.

```{r}
# vii. Age bin distribution in Top 3 Department 

p35 <- hr_df %>%
      select(Age_bin,EmpDepartment, Gender) %>% 
      filter(EmpDepartment %in% c("Sales","R&D", "Development")) %>% 
      group_by(Age_bin,EmpDepartment,Gender) %>%
      dplyr::summarise(count = n()) %>% 
      mutate(pct = round(prop.table(count),2)*100) %>% 
      ggplot(aes(x = EmpDepartment, y =pct ,fill = Age_bin))+
      geom_bar(stat = "identity", color = "black",position = position_dodge())+
      coord_flip()+
      facet_wrap(~Gender)+
      theme_economist()+
      labs(title = "By Gender", x= "Department \n", y = "Percentage(%)")+
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(label = paste0(pct,"%")),
                         color = "black", position = position_dodge(1), size = 2.5)+
      theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position = "none")

p36 <- hr_df %>%
        select(Age_bin,EmpDepartment, Attrition) %>% 
        filter(EmpDepartment %in% c("Sales","R&D", "Development")) %>% 
        group_by(Age_bin,EmpDepartment,Attrition) %>%
        dplyr::summarise(count = n()) %>% 
        mutate(pct = round(prop.table(count),2)*100) %>% 
        ggplot(aes(x = EmpDepartment, y =pct ,fill = Age_bin))+
        geom_bar(stat = "identity", color = "black",position = position_dodge())+
        coord_flip()+
        facet_wrap(~Attrition)+
        theme_economist()+
        labs(title = "By Attrition", x ="Department \n", y ="Percentage(%)")+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label = paste0(pct,"%")),
                         color = "black", position = position_dodge(1), size = 2.5)+
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
          theme(axis.text.y=element_blank())+
        theme(legend.position = "right",legend.text=element_text(size=8))

title <- ggdraw() + draw_label("Age Disribution in top three dept.", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p35,p36,nrow = 1, labels = c("G", "H")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**G**

- 60 % Female in Sales department of Age under 20 compare to Male which is just 40%.
- 80% Male compare to 20% Female in Development Department of Age under 20.
- Rest every Age group is distributed between 60-40.
 
**H**

- 80% in Development and 70% in Sales Department Employee Attrition under 20.
- 4 % in Development and 5% in R&D of Age 40-50 Attrition.

#<span style="color:red">**Age | Department | Gender | Job Role**</span>

```{r}

# Age & Department Stats:

p37 <- hr_df %>% 
group_by(Age_bin, Gender, EmpDepartment) %>% 
dplyr::summarise(count = n()) %>%  
mutate(age_bin_pcnt = paste0(round(prop.table(count),2)*100),"%") %>% 
ggplot(aes(x=Age_bin, y= Gender,fill=Gender, color=Gender))+
geom_area(stat= "identity")+
coord_flip()+
facet_grid(~EmpDepartment)+
theme_wsj()+
labs(x ="Employee Age bin",
     y ="Employee Gender") +
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+ 
theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
geom_label(aes(label=paste0(age_bin_pcnt, "%")), color = "midnightblue", fontface = "bold.italic", size = 2) +
scale_fill_manual(values=c("hotpink","deep sky blue")) +  
scale_color_manual(values=c("hotpink","deep sky blue")) +
theme(axis.text.x = element_text(size = 7))+
theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
theme(legend.position="none")

title <- ggdraw() + draw_label("Employee Age distribution Percentage by Gender & Dept", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p37,nrow = 1, labels = "A") 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**A**

0-20:
- In Finance and Data Science there is no Employee which is under age 20.
- In Human Resource there are 8% Male Employee

20-30: 
- 34% Female in Sales and 32% Male in R&D.

30-40:
- 33 % Female in Development & 33% Male in Sales

40-50:
- 40% Female in Sales & 31 % Male in Development

50-60:
- 41% Female in R&D & 32% Male in Sales.

#<span style="color:red">**Generation**</span>

We can even classify all the Employeer based on their age in four different category. As of dated today 2019.

- Baby Boomers: Baby boomers were born between 1944 and 1964. They're current between 55-75 years old (76 million in U.S.)
- Gen X: Gen X was born between 1965 - 1979 and are currently between 40-54 years old (82 million people in U.S.)
- Gen Y: Gen Y, or Millennials, were born between 1980 and 1994. They are currently between 25-39 years old.
- Gen Y.1 = 25-29 years old (31 million people in U.S.)
- Gen Y.2 = 29-39 (42 million people in U.S.)
- Gen Z: Gen Z is the newest generation to be named and were born between 1995 and 2015. They are currently between 4-24 years old (nearly 74 million in U.S.)


As we don't have many Gen Z in our datasets we will combine Gen Z with Gen Y.2. Otherwise we will have barplots with couple of dots. 

```{r}

p38 <- hr_df %>%
        select(Generation, NumCompaniesWorked, Gender) %>%
        ggplot() + 
        geom_boxplot(aes(x=reorder(Generation, NumCompaniesWorked, FUN=median), #Median removes Outliers 
                       y=NumCompaniesWorked, fill=Generation)) + 
        coord_flip() + 
        facet_wrap(~Gender) + 
        theme_economist_white() +
        labs( title="By Gender",
              x ="Generation \n",
              y ="Prior number of Companies Worked" ) + 
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=10,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none",axis.text.x = element_text(size = 8),
            legend.background = element_rect(fill="powderblue",size=0.5, linetype="solid",color="black"))

conti_hr_df_1 <- as.data.frame.matrix(table(hr_df$Generation, hr_df$Gender))
conti_hr_df_1$groupSum_1 <- rowSums(conti_hr_df_1)
conti_hr_df_1$xmax <- cumsum(conti_hr_df_1$groupSum_1)
conti_hr_df_1$xmin <- conti_hr_df_1$xmax - conti_hr_df_1$groupSum_1

conti_hr_df_1$groupSum_1 <- NULL
conti_hr_df_1$Generation <- rownames(conti_hr_df_1)

melt_hr_df_1 <- melt(conti_hr_df_1, id.vars = c("Generation", "xmin", "xmax"), variable.name = "variable")

hr_df_melt_1 <- melt_hr_df_1 %>%
              group_by(Generation) %>%
              mutate(ymax = cumsum(value/sum(value)),
                     ymin = ymax - value/sum(value))

index <- hr_df_melt_1$xmax == max(hr_df_melt_1$xmax)
hr_df_melt_1$yposn <- hr_df_melt_1$ymin[index] + (hr_df_melt_1$ymax[index] - hr_df_melt_1$ymin[index])/2
hr_df_melt_1$xposn <- hr_df_melt_1$xmin + (hr_df_melt_1$xmax - hr_df_melt_1$xmin)/2

p39 <- hr_df %>%
        select(Generation, NumCompaniesWorked, Attrition) %>%
        ggplot() + 
        geom_boxplot(aes(x=reorder(Generation, NumCompaniesWorked, FUN=median), #Median removes Outliers 
                       y=NumCompaniesWorked, fill=Generation)) + 
        coord_flip() + 
        facet_wrap(~Attrition) + 
        theme_economist_white() +
        labs( title="By Attrition",
              x ="Generation \n",
              y ="Prior number of Companies Worked" ) + 
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none",axis.text.y = element_blank(),
            legend.background = element_rect(fill="powderblue",size=0.5, linetype="solid",color="black"))

# iii. Mosaic Plot: 
p40 <- ggplot(hr_df_melt_1, aes(ymin = ymin, ymax = ymax,xmin = xmin, xmax = xmax, fill = variable)) + 
     geom_rect(colour = "white") +
     theme_economist_white()+
     labs(title="By Gender",
            x = "Employees",
            y = "Frequency \n") + 
     theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
     theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
     theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
     geom_text(aes(x = xposn, label = Generation),
                   y = 0.5, angle = 90,size = 2.5, hjust =0.5,show.legend = FALSE)+
     scale_x_continuous(expand = c(0,0)) +
     scale_y_continuous(expand = c(0,0)) +
     scale_fill_manual(values=c("hotpink","deep sky blue")) +
     theme(legend.position="none",
           legend.background = element_rect(fill="lightblue",size=0.5, linetype="solid", colour ="black"))

conti_hr_df <- as.data.frame.matrix(table(hr_df$Generation, hr_df$Attrition))
conti_hr_df$groupSum <- rowSums(conti_hr_df)
conti_hr_df$xmax <- cumsum(conti_hr_df$groupSum)
conti_hr_df$xmin <- conti_hr_df$xmax - conti_hr_df$groupSum

conti_hr_df$groupSum <- NULL
conti_hr_df$Generation <- rownames(conti_hr_df)

melt_hr_df <- melt(conti_hr_df, id.vars = c("Generation", "xmin", "xmax"), variable.name = "variable")

hr_df_melt <- melt_hr_df %>%
              group_by(Generation) %>%
              mutate(ymax = cumsum(value/sum(value)),
                     ymin = ymax - value/sum(value))

index <- hr_df_melt$xmax == max(hr_df_melt$xmax)
hr_df_melt$yposn <- hr_df_melt$ymin[index] + (hr_df_melt$ymax[index] - hr_df_melt$ymin[index])/2
hr_df_melt$xposn <- hr_df_melt$xmin + (hr_df_melt$xmax - hr_df_melt$xmin)/2

# iii. Mosaic Plot: 
p41 <- ggplot(hr_df_melt, aes(ymin = ymin, ymax = ymax,xmin = xmin, xmax = xmax, fill = variable)) + 
     geom_rect(colour = "white") +
     theme_economist_white()+
     labs(title="By Attrition ",
            x = "Employees",
            y = "Frequency \n") + 
     theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
     theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
     theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
     geom_text(aes(x = xposn, label = Generation),
                   y = 0.5, angle = 90,size = 2.5, hjust = 0.5,show.legend = FALSE)+
     scale_x_continuous(expand = c(0,0)) +
     scale_y_continuous(expand = c(0,0)) +
     scale_fill_manual(values=c("springgreen","tomato")) +
     theme(legend.position="none",axis.text.y = element_blank(),
           legend.background = element_rect(fill="lightblue",size=0.5, linetype="solid", colour ="black"))

title <- ggdraw() + draw_label("Bar Plot & Mosaic Plot of Generations", fontface='bold', size= 10, colour = "red")
bottom_row <- plot_grid(p38,p39,p40,p41, nrow = 2,labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1, 1))
```

**A**

- We Don't have much data for Millenials Gen Y.1.
- We can see some outliers in Millenials Gen Y.2 in both Male and Female
- We can also spot outliers in Baby Boomers in Female.
- Male Baby Boomers have more experienced than Female.

**B**

- There are more outliers in Millenials Gen Y.1 in both leaving the company as well as staying.
- As the prior number of companies worked experience increases we can see Employee tend to leave the company also increases than those who stay.

**C**

- We can see the proportion of Malea and Female Employee by Generations.
- More  Male Millenials Gen Y.1 and Baby Boomers than Female.

**D**

- Millenials Gen Y.1 (Age 25-29) tends to leave the company more than other Generations.

#<span style="color:red">**Martial Status**</span>


```{r}
p42 <- hr_df %>% 
        group_by(MaritalStatus,Attrition) %>% 
        dplyr::summarise(count = n()) %>% 
        mutate(martial_pct = round(prop.table(count),2)*100) %>% 
        ggplot(aes(MaritalStatus, y = martial_pct, fill=Attrition)) +
        geom_bar(stat = "identity")+
        coord_flip()+
        theme_economist()+
        labs( title = "Attrition by Martial Status", y = "Percentage (%)") +
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(martial_pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 3,hjust =0.8, vjust =.75)+ 
        theme(axis.title.y=element_blank())+
        scale_fill_manual(values=c("springgreen","tomato"))+
        theme(legend.position="none")

p43 <- hr_df %>% 
        select(MaritalStatus,Attrition,Gender) %>% 
        group_by(MaritalStatus,Attrition,Gender) %>% 
        dplyr::summarise(count = n()) %>% 
        mutate(m_pct = round(prop.table(count),2)*100) %>%   
        ggplot(aes(factor(MaritalStatus), y = m_pct,fill = factor(Gender))) +
        geom_bar(stat="identity",position = position_stack(reverse = TRUE))+
        facet_wrap(~Attrition)+
        coord_flip()+
        theme_economist()+
        labs( y ="Percentage %",x ="") +
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label_repel(aes(label=paste0(m_pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 3,hjust = 0.5, vjust =0.5)+ 
        scale_fill_manual(values=c("hotpink","deep sky blue")) + 
        scale_color_manual(values=c("hotpink","deep sky blue")) + 
        theme(axis.text.y=element_blank())+
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(legend.position="none")

p44 <- hr_df %>% 
        select(MaritalStatus,Gender) %>% 
        group_by(MaritalStatus,Gender) %>% 
        dplyr::summarise(count = n()) %>%  
        mutate(age_bin_pcnt = round(prop.table(count),2)*100) %>% 
        ggplot(aes(factor(MaritalStatus), y = age_bin_pcnt,fill = factor(Gender))) +
        geom_bar(stat="identity",position = position_stack(reverse = TRUE))+
        coord_flip()+
        theme_economist()+
        labs(title="Gender Distribution by Martial Status",
             x ="",
             y ="Percentage (%)") +
        theme(plot.title = element_text(size = 8, hjust = 0.5, color = "red", face="bold.italic")) +
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(age_bin_pcnt, "%")), color = "midnightblue", fontface = "bold.italic", size = 3,hjust= 0.8, vjust =.75)+       
        scale_fill_manual(values=c("hotpink","deep sky blue")) + 
        scale_color_manual(values=c("hotpink","deep sky blue")) + 
        theme(axis.text.y=element_blank())+
        theme(legend.position="none")

title <- ggdraw() + draw_label("MaritalStatus & Attrition (↓) ", fontface='bold', size= 10, colour = "red")
bottom_row <- suppressMessages(plot_grid(p42,p43,p44,nrow = 1,labels = "AUTO"))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**A, B, C **

- Single tends to leave than Married and Divorced roughly about 24%.
- Almost the Ratio of Male and Female by martial Status is 60:40(M:F)
- Attrition Rate in Male population is 60:40(M:F) in Single and Married whereas in Divorced it is almost 80:20(M:F)
- Employee who stays beside of their Martial Status is almost 60:40(M:F)


```{r}
# Attrition among different department based on Martial Status
p45 <- hr_df %>%
      select(MaritalStatus, EmpDepartment,Attrition) %>%
      group_by(MaritalStatus, EmpDepartment,Attrition) %>% 
      dplyr::summarize(Count=n()) %>% 
      mutate(pct=round(prop.table(Count),2) * 100) %>%
      ggplot(aes(x=fct_reorder(MaritalStatus,pct), y=pct, fill=Attrition, color=Attrition)) + 
      geom_bar(stat="identity", position = position_stack()) +
      coord_flip() + 
      facet_grid(~EmpDepartment) + 
      theme_economist() +
      labs(x="Martial Status \n", y="Percentage(%)")+    
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label_repel(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 2)+ 
      scale_fill_manual(values=c("springgreen","tomato")) + 
      scale_color_manual(values=c("springgreen","tomato")) + 
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none", plot.background=element_rect(fill="lightcyan"))

title <- ggdraw() + draw_label("Attrition across Department based on Martial Status ", fontface='bold', size= 12, colour = "red")
bottom_row <- suppressMessages(plot_grid(p45,nrow = 1,labels = "AUTO"))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1))
```

**D**

- No Attrition in Finance Department if person is Divorced.
- No Attrition in Data Science Department if person is Married.
- High Attrition if the employee is Single in Sales and Data Science Departement.

#<span style="color:red">**Experience Years In CurrentRole & Attrition**</span>

```{r}
p46 <- hr_df %>% 
  group_by(ExperienceYearsInCurrentRole,Attrition) %>% 
  dplyr::summarise(count = n()) %>% 
  mutate(exp_pct = round(prop.table(count),2)*100) %>% 
  ggplot(aes(ExperienceYearsInCurrentRole, y = exp_pct, fill=Attrition)) +
  geom_bar(stat = "identity", position = position_stack())+
  coord_flip()+
  theme_solarized()+
  labs(title = "By Attrition",
        x = "Experience Years In Current-Role \n",
        y = "Percentage (%)")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(plot.subtitle = element_text(size = 14, hjust = 0.5, color = "red", face="bold.italic"))+
  geom_label(aes(label=paste0(exp_pct,"%")), color = "midnightblue", fontface = "bold.italic", size = 1.5,position = position_stack())+
  scale_fill_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")

p47 <- hr_df %>% 
  group_by(ExperienceYearsInCurrentRole,Gender) %>% 
  dplyr::summarise(count = n()) %>% 
  mutate(exp_pct = round(prop.table(count),2)*100) %>% 
  ggplot(aes(ExperienceYearsInCurrentRole, y = exp_pct, fill=Gender)) +
  geom_bar(stat = "identity", position = position_stack())+
  coord_flip()+
  theme_solarized()+
  labs(title = "By Gender ",
        x = "Experience Years In Current-Role \n",
        y = "Percentage (%)")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(plot.subtitle = element_text(size = 14, hjust = 0.5, color = "red", face="bold.italic"))+
  geom_label(aes(label=paste0(exp_pct,"%")), color = "midnightblue", fontface = "bold.italic", size = 1.5, position = position_stack())+
  scale_fill_manual(values=c("hotpink","deep sky blue"))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Experience Years In Current-Role", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p46,p47,ncol = 2, labels = c("A", "B")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**A**

- As you gain more experience in current Role you are less likely to leave.
- If you have 10 years of experience it is less likely you will leave until and unless there is major change. As we can see there is one outlier in 14 years of experience in current role.
- Percenatage of Attrition keeps on decreasing as once Employee have more experience in current role.

**B**

- There are less Male with more than 10 years of experience in current role than Female except one exception at 18 years of experience.
- Female tends to be more stable as we move up in experience except year 9 and 10 where ratio changes from 60:40(M:F) to 70:30(M:F)  then as we move up ratio seems 30:70(M:F)


#<span style="color:red">**Overtime**</span>


```{r}
# Cross table
CrossTable(hr_df$Attrition, hr_df$OverTime) # Cross table Attrition vs Overtime.
```

```{r}

p48 <- hr_df %>% 
          group_by(Gender,OverTime) %>% 
          dplyr::summarise(count=n()) %>%
          mutate(ovt_pct = round(prop.table(count),2)*100) %>% 
          ggplot(aes(x=OverTime, y=ovt_pct, fill=Gender)) + 
          geom_bar(stat="identity", position=position_stack()) +
          coord_flip()+
          theme_economist() +  
          labs(title="By Gender",x="Overtime \n", y="Percentage(%)")+
          theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+ 
          theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
          theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
          geom_label(aes(label=paste0(ovt_pct, "%")), position=position_stack(),color = "black", fontface = "bold", size=4)+
          scale_fill_manual(values=c("hotpink","deep sky blue")) + 
          theme(legend.position="none")

# pie chart
p49 <- hr_df %>% 
  select(OverTime, Attrition) %>% 
  filter(Attrition == "Yes") %>% 
  group_by(Attrition, OverTime) %>%
  dplyr::summarize(n=n()) %>% 
  mutate(pct=round(prop.table(n),2) * 100) %>% 
  ggplot(aes(x="", y=pct, fill=OverTime)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) +
  theme_wsj() +
  labs(title="By Overtime", subtitle="In Percent", x="", y="") +
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(label=paste0(n))) +
  geom_label(aes(label = paste0(pct, "%")),position = position_stack(vjust =0.3), color = "black",  fontface =    "italic")+
  scale_fill_manual(values=c("springgreen","tomato")) + 
  theme(legend.position="bottom",
        strip.background = element_blank(),
        strip.text.x = element_blank(), 
        plot.title=element_text(hjust=0.7, color="black"),
        plot.subtitle=element_text(color="black"),
        axis.text.x=element_text(colour="black"),
        axis.text.y=element_text(colour="black"),
        axis.title=element_text(colour="black"), 
        legend.background = element_rect(fill="#FFF9F5",size=1, linetype="solid", colour ="black")) 


title <- ggdraw() + draw_label("Level of Attrition", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p48,p49,ncol = 2, labels = c("A", "B")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))

```

**A**

- Equal distribution on Overtime By Gender.
- 28% Male and 32% Female does Overtime. Female seems do to Overtime Compare to Male.

**B**

- 54 % People do leeave the company if they are doing Overtime.In our datasets we have 96 people left compare to 82 who did stay beside doing overtime.

```{r}
# C: Overtime & Gender
p50 <- hr_df %>% 
          group_by(Gender,OverTime) %>% 
          dplyr::summarise(count=n()) %>%
          mutate(ovt_pct = round(prop.table(count),2)*100) %>% 
          ggplot(aes(x=reorder(OverTime, -ovt_pct), y=ovt_pct, fill=Gender)) + 
          geom_bar(stat="identity", position=position_stack()) +
          coord_flip()+
          theme_economist() +  
          labs(title="By Gender",x="Overtime \n", y="Percentage(%)")+
          theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+ 
          theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
          theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
          geom_label(aes(label=paste0(ovt_pct, "%")), position=position_stack(),color = "black", fontface = "bold", size=4)+
          scale_fill_manual(values=c("hotpink","deep sky blue")) + 
          theme(legend.position="none")

# D:  Overtime, Gender, Attrition
p51 <- hr_df %>%
        select(Gender,OverTime,Attrition) %>%
        group_by(OverTime, Gender,Attrition) %>% 
        dplyr::summarize(Count=n()) %>% 
        mutate(pct = round(prop.table(Count),2)*100) %>%  
        ggplot(aes(x=fct_reorder(OverTime,pct), y=pct, fill=Attrition, color=Attrition)) + 
        geom_bar(stat="identity", position = position_stack()) +
        coord_flip()+
        facet_wrap(~Gender) + 
        theme_economist() +
        labs(x="Over Time \n", y="Percentage (%)", title=" Over Time Attrition among Genders")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 4)+ 
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        scale_fill_manual(values=c("springgreen","tomato")) + 
        scale_color_manual(values=c("springgreen","tomato")) +        
        theme(legend.position="none", plot.background=element_rect(fill="lightcyan"))



title <- ggdraw() + draw_label("OverTime", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p50, p51, ncol = 2, labels = c("C", "D"))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**C**

- 32% Female Employee seems to do Overtime compare to 28%  Male Employee.

**D**

- When we groupby by OverTime, Gender and then by Attrition we see that : 
- 31% Male Seems to leave the company compare to 23% Female who works OverTime.


```{r}
# E: Overtime by Empdept.

p52 <- hr_df %>% 
        group_by(EmpDepartment,OverTime) %>% 
        dplyr::summarise(count=n()) %>%
        mutate(ovt_pct = round(prop.table(count),2)*100) %>% 
        ggplot(aes(x=reorder(EmpDepartment, -ovt_pct), y=ovt_pct, fill=OverTime)) + 
        geom_bar(stat="identity", position=position_stack()) +
        coord_flip()+
        theme_economist() +   
        labs(title="Across Dept.",x="Department \n ", y="Percentage(%)")+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=count), position=position_stack(),color = "black", fontface = "bold", size =4)+
        geom_label(aes(label=paste0(ovt_pct, "%")),position=position_stack(), color = "midnightblue", fontface =        "bold.italic", size = 2.5) +
        scale_fill_manual(values=c("tomato","springgreen")) +
        scale_color_manual(values=c("tomato","springgreen")) +
        theme(legend.position="none")

# F.  OverTime, EmpDepartment,Attrition

p53 <- hr_df %>%
        select(EmpDepartment, OverTime,Attrition) %>%
        group_by(EmpDepartment,OverTime,Attrition) %>% 
        dplyr::summarize(Count=n()) %>% 
        mutate(pct=round(prop.table(Count),2) * 100) %>%
        ggplot(aes(x=fct_reorder(OverTime,pct), y=pct, fill=Attrition, color=Attrition)) + 
        geom_bar(stat="identity", position = position_stack()) +
        coord_flip() + 
        facet_wrap(~EmpDepartment) + 
        theme_economist() + 
        labs(x="Over Time \n", y="Percentage (%)")+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 2.5)+
        theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
        scale_fill_manual(values=c("springgreen","tomato")) + 
        scale_color_manual(values=c("springgreen","tomato")) + 
        theme(legend.position="none")


title <- ggdraw() + draw_label("OverTime Attrition", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p52, p53, nrow = 2,labels = c("E", "F"))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**E**

- In Data Science Employee seems to do more OverTime compare to rest of Other Department.

**F**

- Sales and Data Science Department have more Attrition when they work OverTime than rest of Department.

```{r}

# G. Attrition by job Role OverTime = YES
p54 <- hr_df %>% 
       select(OverTime,EmpJobRole,Attrition,Gender) %>% 
       filter(OverTime == "Yes") %>% 
       group_by(EmpJobRole,Gender,Attrition) %>% 
       dplyr::summarise(count = n()) %>%  
       mutate(pct = round(prop.table(count),2)*100) %>%
       ggplot(aes(x=EmpJobRole, y=pct, fill = Attrition, color = Attrition)) +
       geom_bar(stat="identity", position = position_stack()) +
       coord_flip() +
       facet_wrap(~Gender)+
       theme_economist() + 
       labs(x = "Job Role \n",
            y = "Percentage(%)", 
            title = "When work OT")+
       theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 1.5)+
       theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
       scale_fill_manual(values=c("springgreen","tomato")) +
       scale_color_manual(values=c("springgreen","tomato")) +
       theme(axis.text.x = element_blank())+
       theme(legend.position="none")

# H. Attrition by job Role OverTime = NO 
p55 <- hr_df %>% 
  select(EmpJobRole,OverTime, Gender,Attrition) %>% 
  filter(OverTime == "No") %>% 
  group_by(EmpJobRole,Gender,Attrition) %>% 
  dplyr::summarise(count = n()) %>%  
  mutate(pct = round(prop.table(count),2)*100) %>% 
  ggplot(aes(x=EmpJobRole, y=pct, fill = Attrition, color = Attrition)) +
  geom_bar(stat="identity", position = position_stack()) +
  coord_flip() +
  facet_wrap(~Gender)+
  theme_economist() + 
  labs(x ="Job Role \n ",
       y ="Percentage(%)", 
       title =" When NOT work OT")+
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  geom_label(aes(label=paste0(pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 1.5, hjust = 0.5, vjust = 0.5)+ 
  scale_fill_manual(values=c("springgreen","tomato")) +
  scale_color_manual(values=c("springgreen","tomato")) +
  theme(axis.text.x = element_blank(), axis.title.y = element_blank(), axis.text.y = element_blank())+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Job Role & Attrition", fontface='bold', size= 10, colour = "red")
bottom_row <- suppressMessages(plot_grid(p54,p55,nrow = 1,labels = c("G", "H"),rel_widths = c(0.70, 0.30)))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**G**

- Female Laboratory Technician tends to leave 100% when Work OverTime but if its Male Laboratory Technician then case seems to be completly opposite.
- Female Sales Represenatative tends to leave 67% of time.
- There is No Female Data Scientist & Female Technical Architect who have worked OverTime.
- There is No Male Business Analyst who have worked OverTime.
- 67% of Male Finance Manager seems to leave the company if they work OverTime.

**H**

- Male Technical Architect only seems to leave the company even Not working Overtime.

Rest of them are splitted more or less.

#<span style="color:red">**Employee Environment Satisfaction**</span>

i. Employee Environment Satisfaction vs. Attrition.
ii. Employee Environment Satisfaction vs. Attrition vs. EmpDepartment.
iii. Employee Environment Satisfaction vs. Job Role  vs. Attrition.
iv. Age vs. Job Role  vs. Attrition.
v. Hourly Rate vs. Job Role  vs. Attrition.

```{r}
p56 <- hr_df %>% 
        group_by(EmpDepartment,EmpEnvironmentSatisfaction) %>% 
        dplyr::summarise(count=n()) %>%
        mutate(ovt_pct = round(prop.table(count),2)*100) %>% 
        ggplot(aes(x=EmpDepartment, y=ovt_pct, fill=factor(EmpEnvironmentSatisfaction), color =factor( EmpEnvironmentSatisfaction))) + 
        geom_bar(stat="identity", position=position_stack(reverse = TRUE)) +
        coord_flip()+
        theme_economist() +   
        labs(title="Environment Satisfaction across Dept.",x="Department \n ", y="Percentage(%)")+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(ovt_pct, "%")),position=position_stack(reverse = TRUE), color = "midnightblue", fontface =        "bold.italic", size = 2.5) +
        theme(legend.position="top", legend.title = element_blank())

title <- ggdraw() + draw_label("EmpEnvironmentSatisfaction", fontface='bold', size= 10, colour = "red")
bottom_row <- plot_grid(p56,nrow = 1,labels = "A")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**A**
- Employee working in top 3 Department have low satisfaction score roughly around 20%.
- HR Employee have satisfaction score around 3 for 41% of Employees also only 20% of them have fully score of 4 as Employee Satisfaction Score.

```{r}
p57 <- ggplot(hr_df ,aes(x=Attrition, y=EmpEnvironmentSatisfaction, fill =Attrition , color = Attrition )) +
geom_boxplot(color="black")+
coord_flip()+
theme_solarized()+
labs(title = "By Attrition",
     x =  "Satisfaction Level \n",
     y = "Emp Environment Satisfaction")+
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.text.x = element_text(angle=45, vjust=0.4)) +
scale_fill_manual(values=c("springgreen","tomato"))+
theme(legend.position="none")


p58 <- ggplot(hr_df ,aes(x=Attrition, y=EmpEnvironmentSatisfaction, fill =Attrition , color = Attrition )) +
geom_boxplot(color="black")+
coord_flip()+
facet_grid(~EmpDepartment)+
theme_solarized()+
labs(title = "Across Department",
     x =  "Satisfaction Level \n",
     y = "Emp Environment Satisfaction")+
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.text.x = element_text(angle=45, vjust=0.4)) +
scale_fill_manual(values=c("springgreen","tomato"))+
theme(legend.position="none")

title <- ggdraw() + draw_label("Emp Environment Satisfaction Level", fontface='bold', size= 10, colour = "red")
bottom_row <- suppressMessages(plot_grid(p57,p58,ncol = 1,labels = c("B", "C")))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))

```

**B**
- As we can see if Employee are less satisfied with the Environment that you work with. You are more prone to leave the company that to stay. 

**C**
- In Finance even if the Employee have greater Environment Satisfaction they seems to leave. So In Finance department Satisfaction Level has no role to keep or leave the employee.
- In Sales, Development, R&D, HR we can see there is effect of Emp Environment Satisfaction on Attrition.

```{r}
# Environment Satisfaction let's use the changes by JobRole

# EmpEnvironmentSatisfaction vs. Job Role  vs. Attrition
p59 <- hr_df %>% 
  select(EmpEnvironmentSatisfaction, EmpJobRole, Attrition) %>% 
  group_by(EmpJobRole, Attrition) %>%
  dplyr::summarize(avg.env=mean(EmpEnvironmentSatisfaction)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg.env)) +
  geom_line(aes(group=Attrition), color="purple", linetype="dashed") + 
  geom_point(aes(color=Attrition), size=3) + 
  coord_flip()+
  theme_minimal() + 
  labs(title="Satisfaction", y="Avg.Env", x="Job Role \n") + 
  theme(plot.title = element_text(size = 8, hjust = 0.5, vjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.text.x=element_text(angle=90),plot.background=element_rect(fill="#FFF1E0")) +
  scale_color_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")+
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm"))

#  Emp Environment Satisfaction & Attrition 
          
p60 <- hr_df %>% 
      group_by(EmpEnvironmentSatisfaction,Attrition) %>% 
      dplyr::summarise(count = n()) %>% 
      mutate(emp_pct = round(prop.table(count),2)*100) %>% 
      ggplot(aes(EmpEnvironmentSatisfaction, y = emp_pct, fill=Attrition)) +
      geom_bar(stat = "identity", position = position_stack())+
      coord_flip()+
      theme_solarized()+
      labs(title = "Attrition vs Satisfaction",
        x= "Count \n",
           y = "Env.Satisfaction")+
      theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      geom_label(aes(label=paste0(emp_pct,"%")),
                 color = "midnightblue", fontface = "bold.italic", size = 2, position = position_stack())+ 
      scale_fill_manual(values=c("springgreen","tomato"))+
      theme(legend.position="none")



title <- ggdraw() + draw_label("Emp Environment Satisfaction Level", fontface='bold', size= 10, colour = "red")
bottom_row <- plot_grid(p59,p60, nrow = 2, labels = c("D", "E"),rel_heights = c(1, 0.5),rel_widths =  c(1, 0.5),scale = 0.97)
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**D**
- Any Employee who has Satisfaction Score around 2.5 or less have all left the company.
- There is one exception for the Finance Manager who has Satisfaction score for 4 and have left the company.

**E**
- We have 25% of Employee whose Satisfaction score is 1 and have left the company.

#<span style="color:red">**Employee Relationship Satisfaction**</span>


```{r}
p61 <- ggplot(hr_df, aes(y=EmpRelationshipSatisfaction, x=EmpDepartment, color = EmpDepartment, fill = EmpDepartment)) +
        geom_boxplot()+
        coord_flip()+
        theme_pander()+
        labs(title = "Across dept",x = 'Department \n', y ='Satisfaction level')+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.text.x = element_text(angle=45, vjust=0.4)) +
        scale_fill_manual(values=c("#76EEC6", "#E9967A", "#528B8B", "#FF6EB4", "#8B814C", "#836FFF")) +
        scale_color_manual(values=c("#76EEC6", "#E9967A", "#528B8B", "#FF6EB4", "#8B814C", "#836FFF")) +
        theme(legend.position = "none")

p62 <- ggplot(hr_df, aes(y = EmpRelationshipSatisfaction, x =EmpDepartment,fill = Gender)) + 
        geom_boxplot(notch = FALSE)+
        coord_flip()+
        facet_grid(~ Attrition,scale = "free")+
        theme_pander()+
        labs(title = "By Attrition & Gender",x = '', y ='Satisfaction level')+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(strip.text = element_text(face="bold", size=5),strip.background = element_rect(fill="orange", color="black",size=0.5))+
        scale_fill_manual(values=c("hotpink","deep sky blue")) +
        theme(axis.text.y=element_blank())+
        theme(legend.position = "none")


title <- ggdraw() + draw_label("Satisfaction Level", fontface='bold', size= 12, colour = "red")
bottom_row <- suppressMessages(plot_grid(p61,p62,nrow = 1,labels = c("A", "B"))) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```


**A**
- Only Data Science field deviate towards less than 2 on average Employee Relationship Satisfaction compare to all other Department.

**B**

- When we break it down by Gender and Attrition although Data Science field have less score on Employee Relationship Satisfaction they haven't left the company. Males shows more less Employee Relationship Satisfaction score than Females.
- In Human Resource Male with high Employee Relationship Satisfaction Score seems to leave than Female.
- In Finance Male with low Employee Relationship Satisfaction definetly  leaves the company.

#<span style="color:red">**Years with Manager**</span>


```{r}

hr_df %>% 
  select(Gender,CatYearsManager) %>% 
  ftable() %>% 
  prop.table() %>% {. * 100} %>% round(2)

hr_df %>% 
  select(Gender,CatYearsManager, Attrition) %>% 
  ftable() %>% 
  prop.table() %>% {. * 100} %>% round(2)

hr_df %>% 
  select(Gender, Attrition, EmpDepartment) %>% 
  ftable() %>% 
  prop.table() %>% {. * 100} %>% round(2)

p63 <- hr_df %>% 
        select(YearsWithCurrManager, EmpRelationshipSatisfaction, Attrition) %>%
        group_by(YearsWithCurrManager, Attrition) %>%
        dplyr::summarize(avg.sat=mean(EmpRelationshipSatisfaction)) %>%
        ggplot(aes(x=YearsWithCurrManager, y=avg.sat, fill=Attrition)) +
        geom_bar(stat="identity", position=position_stack()) +
        coord_flip() +
        facet_wrap(~Attrition)+
        theme_economist() +
        labs(x="Current Manager(Yrs.) \n",y="Average Satisfaction Score", title="Dealing with Current Managers") + 
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_fill_manual(values=c("springgreen","tomato"))+
        theme(legend.position="none",
              strip.background = element_blank(),
              strip.text.x = element_blank(),
              axis.text.y = element_text(angle = 0)) 
                  
# Create a Distribution by Attrition of the RelationShip Satisfaction
p64 <- hr_df %>% 
        select(EmpRelationshipSatisfaction, Attrition) %>%
        group_by(Attrition) %>% 
        ggplot(aes(x=EmpRelationshipSatisfaction, y=..density..)) + 
        geom_density(aes(fill=Attrition)) +
        facet_wrap(~Attrition) + 
        theme_economist() +
        labs(title = "Attrition Density Plot ", y="density \n",x="Average Satisfaction Score") + 
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        scale_fill_manual(values=c("springgreen","tomato"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_fill_manual(values=c("springgreen","tomato"))+
        theme(legend.position="none", strip.background = element_blank(), strip.text.x = element_blank())
            
title <- ggdraw() + draw_label("Years with Manager", fontface='bold', size= 12, colour = "red")
bottom_row <- suppressMessages(plot_grid(p63,p64,ncol = 2,labels = c("A", "B"))) 
plot_grid(title, bottom_row,nrow = 2, labels = c("","","C"),rel_heights = c(0.05,0.7,1.3))
```

**A**

- If Employee have dealt mostly with current Managers for really long time they tend to stay. As year increases Attrition decreases.
- On an average Employee dealing with current Managers have Average Satisfaction score of 2.5

**B**
- We can see the density plot of Employee Leaving Average Satisfaction score and Employee staying Average Satisfaction score.The peak value defines the difference in thier Average Satisfaction score.

#<span style="color:red">**Employee Job Satisfaction**</span>


```{r}
#  A. OverTime & EmpJobSatisfaction
p65 <- hr_df %>% 
        group_by(EmpJobSatisfaction,OverTime) %>% 
        dplyr::summarise(count=n()) %>%
        mutate(ovt_pct_sat = round(prop.table(count),2)*100) %>% 
        ggplot(aes(x=EmpJobSatisfaction, y=ovt_pct_sat, fill=OverTime)) + 
        geom_bar(stat="identity", position="dodge") +
        coord_flip()+
        #facet_wrap(~OverTime)+
        theme_solarized()+
        labs(title="By Overtime",
             x="Job Satisfaction \n",
             y="Percentage(%)")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=count), position=position_dodge(width=0.9),color = "black", fontface = "bold", size =4)+
        geom_label(aes(label=paste0(ovt_pct_sat, "%")),position=position_dodge(width=0.9), color = "midnightblue", fontface = "bold.italic", size = 2.5) +
        scale_fill_manual(values=c("springgreen","tomato"))+
        theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(legend.position = "none")


# B. EmpJobSatisfaction  & Attrition
p66 <- hr_df %>% 
        group_by(EmpJobSatisfaction,Attrition) %>% 
        dplyr::summarise(count=n()) %>%
        mutate(attr_pct_sat = round(prop.table(count),2)*100) %>% 
        ggplot(aes(x=reorder(EmpJobSatisfaction, -attr_pct_sat), y=attr_pct_sat, fill=Attrition)) + 
        geom_bar(stat="identity", position="dodge") +
        coord_flip()+
        #facet_wrap(~Attrition)+
        theme_solarized()+
        labs(title="By Attrition",
             x="Job Satisfaction \n",
             y="Percentage(%)")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=count), position=position_dodge(width=0.9),color = "black", fontface = "bold", size =4)+
        geom_label(aes(label=paste0(attr_pct_sat, "%")),position=position_dodge(width=0.9), color = "midnightblue", fontface ="bold.italic", size = 2.5) +
      scale_fill_manual(values=c("springgreen","tomato"))+
       theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(legend.position = "none")

title <- ggdraw() + draw_label("Employee Job Satisfaction", fontface='bold', size= 12, colour = "red")
bottom_row <- suppressMessages(plot_grid(p65,p66,ncol = 2,labels = "AUTO"))
plot_grid(title, bottom_row,nrow = 2, labels = c("","","C"),rel_heights = c(0.05,1,1))
```


**A**
- Employee Job Satisfaction score with OverTime is splitted 70:30 (No:Yes)

**B**
- Low Job Satisfaction Score tends to leave the company more than than high Employee Job Satisfaction.

```{r}
# C. 
p67 <- hr_df %>% 
group_by(EmpDepartment, EmpJobSatisfaction) %>% 
dplyr::summarise(count = n()) %>% 
mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
ggplot(aes(x = EmpDepartment, y = gender_pct,fill = as.factor(EmpJobSatisfaction), color=as.factor(EmpJobSatisfaction)))+
geom_bar(stat = "identity",position = position_stack(reverse = TRUE))+
coord_flip()+
theme_solarized()+
labs(title="By Department",
     x ="Department \n",
     y ="Percentage(%)") + 
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
geom_label(aes(x= EmpDepartment, label = paste0(gender_pct,"%")),
             hjust =0.5, position = position_stack(reverse = TRUE), size = 2.5, color = 'black', fontface = 'bold') +
theme(legend.text=element_text(size=8),legend.position = "none",legend.box = "horizontal",legend.title=element_blank())

# D. 
p68 <- hr_df %>% 
group_by(MaritalStatus, EmpJobSatisfaction) %>% 
dplyr::summarise(count = n()) %>% 
mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
ggplot(aes(x = MaritalStatus, y = gender_pct,fill = as.factor(EmpJobSatisfaction), color=as.factor(EmpJobSatisfaction)))+
geom_bar(stat = "identity",position = position_stack(reverse = TRUE))+
coord_flip()+
theme_solarized()+
labs(title="By MaritalStatus",
     x ="Marital Status \n",
     y ="Percentage(%)") + 
theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
geom_label(aes(x= MaritalStatus, label = paste0(gender_pct,"%")),
             hjust =0.5, position = position_stack(reverse = TRUE), size = 2.5, color = 'black', fontface = 'bold') +
theme(legend.text=element_text(size=8),legend.position = "right",legend.box = "horizontal",legend.title=element_blank())

title <- ggdraw() + draw_label(" Employee Job Satisfaction", fontface='bold', size= 10, colour = "red")
bottom_row <- suppressMessages(plot_grid(p67,p68,ncol = 2,labels = c("C","D")))
plot_grid(title, bottom_row,nrow = 2, labels = c("","","C"),rel_heights = c(0.05,1,1),rel_widths = c(0.1,1,1) )
```

**C**
- Same top 3 department have low Employee Job Satisfaction score.

**D**
- Martial Status seems independent of Employee Job Satisfaction. Roughly equally distributed.


#<span style="color:red">**Worklife Balance**</span>


WorkLifeBalance. From Data Dictionary
1: 'Bad' 2: 'Good' 3:'Better' 4: 'Best'

```{r}
#  A. vs. Department
p69 <- hr_df %>% 
  select(EmpWorkLifeBalance,EmpDepartment) %>%
  group_by(EmpDepartment,EmpWorkLifeBalance) %>%
  dplyr::summarize(count=n()) %>% 
  mutate(pct= round(prop.table(count),2)*100) %>% 
  ggplot(aes(x=EmpWorkLifeBalance, y=pct, fill=EmpDepartment)) +
  geom_bar(stat='identity', position = position_stack()) + 
  coord_flip()+
  facet_grid(~EmpDepartment) + 
  theme_classic()+
  labs(title="Across Dept", x="Work Life Balance \n", y="Percentage(%)")+
  theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(label = paste0(pct,"%"), fill = EmpDepartment), position = position_stack(),color = "black", fontface = "italic", size = 2.5, hjust = 0.5, vjust = 0.5) +
  scale_fill_manual(values=c("#C1FFC1", "#FFC125", "#FFE4E1", "#B9D3EE","#698B22", "#CD96CD")) + 
  theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(axis.text.x=element_blank())+
  theme(legend.position="none")

# B. Vs. Age_bin
p70 <- hr_df %>% 
  select(Age_bin,EmpWorkLifeBalance) %>%
  group_by(Age_bin,EmpWorkLifeBalance) %>%
  dplyr::summarize(count=n()) %>% 
  mutate(pct= round(prop.table(count),2)*100) %>% 
  ggplot(aes(x=Age_bin, y=pct, fill= as.factor(EmpWorkLifeBalance), color = as.factor(EmpWorkLifeBalance))) +
  geom_bar(stat='identity', position = position_stack(reverse = TRUE)) + 
  coord_flip()+
  facet_grid(~EmpWorkLifeBalance)+
  theme_classic()+
  labs(title="By Age Group",
       x="Age_group \n",
       y="Percentage(%)")+
  theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(label = paste0(pct,"%"), fill = as.factor(EmpWorkLifeBalance)), color = "black", fontface = "italic", size = 2.5, position = position_stack(reverse = TRUE), vjust = 0.5, hjust = 0.5) + 
  theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(axis.text.x=element_blank())+
  theme(legend.text=element_text(size=4),
        legend.position = "none",
        legend.box = "horizontal",
        legend.title=element_blank())
  

# C. vs. Gender
p71 <- hr_df %>% 
 select(Gender,EmpWorkLifeBalance) %>%
 group_by(Gender,EmpWorkLifeBalance) %>%
 dplyr::summarize(count=n()) %>% 
 mutate(pct= round(prop.table(count),2)*100) %>% 
 ggplot(aes(x=EmpWorkLifeBalance, y=pct, fill=Gender)) +
 geom_bar(stat='identity', position = position_stack()) + 
 coord_flip()+
 theme_classic()+
 labs(title="By Gender", x="Work Life Balance \n", y="Percentage (%)")+
 theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
 theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
 theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
 geom_label(aes(label = paste0(pct,"%"), fill = Gender), position = position_stack(), color = "black", fontface = "italic", size = 2.5) +
 scale_fill_manual(values=c("hotpink","deep sky blue"))+
 theme(axis.text.x=element_blank())+    
 theme(legend.position = "none")
  
# vs. Attrition
p72 <- hr_df %>% 
  group_by(EmpWorkLifeBalance,Attrition) %>% 
  dplyr::summarise(count = n()) %>% 
  mutate(gender_pct = round(prop.table(count),2)*100) %>% # convert it into %. 
  ggplot(aes(x = EmpWorkLifeBalance, y = gender_pct,fill =Attrition, color=Attrition))+
  geom_bar(stat = "identity", position = position_stack())+
  coord_flip()+
  theme_classic()+
  labs(title="Attrition",
       x ="Work Life Balance \n",
       y ="Percentage(%)") + 
  theme(plot.title = element_text(size = 8, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(x= EmpWorkLifeBalance, label = paste0(gender_pct,"%")),
               hjust =0.5, position = position_stack(), size = 2.5, color = 'black', fontface = 'bold')+
  scale_fill_manual(values=c("springgreen","tomato"))+
  scale_color_manual(values=c("springgreen","tomato"))+
  theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.text=element_text(size=8),
        legend.position = "none",
        legend.box = "horizontal",
        legend.title=element_blank())

title <- ggdraw() + draw_label("Work Life Balance", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p69,p70,p71,p72, nrow = 2,labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```


**A**

- 15% Employee Working in Data Science Department have worst Work Life Balance.
- 15% Employee Working in Human Resource Department have best Work Life Balance.
- Most of the Department have Work Life Balance score of 3.

**B**

- Most of the Employee have Better Work Life Balance at different Age group.
- 27% of Emploee of Age 0-20 have Work Life Balance of 4.

**C**

- Most of the Male and Female Employee have work Life Balance Score equally splitted between all scores. 

**D**

- WorkLife Balance of Score 1 are more likely to Leave as we can see there 27% Attrition.

#<span style="color:red">**Distance from Home**</span>


```{r}
# Overall Distance from Home of our data.

# Average Mean Distance:
avg_mean_distance <- hr_df %>% summarise(avg=mean(DistanceFromHome))

# Average Median Distance
avg_median_distance <- hr_df %>% summarise(avg=median(DistanceFromHome))

# Mean distance by Gender: 
# Overall Age distribution of Male and Female Population
gender_dfh <- hr_df %>% group_by(Gender) %>%  summarise(avg=mean(DistanceFromHome))

#i. Density Distance From Home Distribution
p73 <- ggplot(hr_df, aes(x = DistanceFromHome))+ 
  geom_histogram(aes(y = ..density..,color = Gender,fill = Gender),alpha = 0.5,position = "identity",bins = 30) + 
  geom_density(aes(color = Gender), size =1)+
  theme_minimal()+
  labs(title="Density Distance Distribution",
        x = "Distance From Home",
        y = "Density \n") +
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  scale_fill_manual(values=c("hotpink","deep sky blue")) +  
  scale_color_manual(values=c("hotpink","deep sky blue")) +
  theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
  theme(legend.position = "none")

# ii. Barplot Distance from Home Distribution
p74 <- ggplot(hr_df, aes(x = DistanceFromHome))+ 
    geom_histogram(aes(color = Gender, fill = Gender), alpha = 0.6, position = "dodge", bins = 30) +
    geom_vline(aes(xintercept = median(DistanceFromHome)), linetype = "dashed", color = "red")+
    geom_vline(aes(xintercept = mean(DistanceFromHome)), linetype = "solid", color = "purple")+
    theme_minimal()+
    labs(title="Barplot Distance Distribution",
            x = "Distance from Home",
            y = "Count \n") + 
    theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
    theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    annotate("text", label = "Avg_Median = 7", x = 14, y = 90, color = "red",size = 3)+
    annotate("text", label = "Avg_Mean = 9.16", x =14, y = 60, color = "purple",size = 3)+
    scale_fill_manual(values=c("hotpink","deep sky blue")) +  # inside color of the box
    scale_color_manual(values=c("hotpink","deep sky blue")) +
    theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
    theme(legend.position = "none")

d_f_h <- hr_df %>% group_by(Gender) %>% summarize(d_f_h_mean = mean(DistanceFromHome))

# iii. Mean Age Distribution
p75 <- ggplot(hr_df, aes(x = DistanceFromHome))+ 
      geom_density(aes(fill = Gender), alpha = 0.4) +
      geom_vline(data = d_f_h, aes(xintercept = d_f_h_mean, color = Gender), linetype = "dashed")+
      theme_minimal()+
      labs(title="Mean Distance Distribution",
              x ="Distance From Home",
              y ="Density \n") + 
    theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
    theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    annotate("text",label = "F_Mean = 9.181", x = 14, y = 0.06, color = "hotpink",size = 3)+
    annotate("text", label = "M_Mean = 9.155", x = 14, y = 0.05, color = "deep sky blue", size = 3)+
    scale_fill_manual(values=c("hotpink","deep sky blue")) +  # inside color of the box
    scale_color_manual(values=c("hotpink","deep sky blue")) +
    theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
    theme(legend.position = "none")


p76 <- ggplot(hr_df, aes(x = DistanceFromHome))+ 
    geom_histogram(aes(color = Attrition, fill = Attrition),alpha = 0.6,position = position_stack(), bins = 30) +
    geom_vline(aes(xintercept = median(DistanceFromHome)), linetype = "dashed", color = "red")+
    geom_vline(aes(xintercept = mean(DistanceFromHome)), linetype = "solid", color = "purple")+
    theme_minimal()+
    labs(title="Barplot Distance Distribution",
            x = "Distance from Home",
            y = "Count \n") + 
    theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
    theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
    annotate("text", label = "Avg_Median = 7", x = 14, y = 90, color = "red",size = 3)+
    annotate("text", label = "Avg_Mean = 9.16", x =14, y = 60, color = "purple",size = 3)+
    scale_fill_manual(values=c("springgreen","tomato")) +  # inside color of the box
    scale_color_manual(values=c("springgreen","tomato")) +
    theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
    theme(legend.position = "none")

title <- ggdraw() + draw_label("Distance from Home Distribution", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p73,p74,p75,p76, nrow = 2,labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**A**

- Most of the Employee lives pretty close to Home.
- Both Male and Female employee lives within 10 Miles Radius.

**B**

- Average Median Distance for all Employee is 7.
- Averageg Mean Distance for all Employee is 9.16.


**C**

- Mean Distance for All Female Employee is 9.181
- Mean Distance for All Male Employee is 9.155.

**D**

- Distance from Home is less likely factor for Attrition as we see very less Attrition just based on Distance from Home.

```{r}
# E. 
p77 <- ggplot(hr_df, aes(x =as.factor( DistanceFromHome)))+
      geom_bar(aes(y = (..count..)/sum(..count..),color = Generation, fill = Generation),alpha = 0.6,position = position_stack()) +
#geom_text(aes(y = ((..count..)/sum(..count..)), label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust = 0.5, hjust = 0.5, size = 2.5,position = position_stack()) +
      scale_y_continuous(labels = percent) +
      theme_classic()+
      labs(title="Histogram distribution",
              x = "Distance from Home",
              y = "Count \n") + 
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
      theme(legend.position = c(0.95, 0.95),legend.justification = c("right", "top"))

# F.

p78 <- hr_df %>%
        select(Generation, DistanceFromHome, Attrition) %>%
        ggplot() + 
        geom_boxplot(aes(x=reorder(Generation, DistanceFromHome, FUN=median), #Median removes Outliers 
                       y=DistanceFromHome, fill=Generation)) + 
        coord_flip() + 
        facet_wrap(~Attrition) + 
       theme_classic()+
        labs( title="Attrition & Generation",
              x ="Generation \n",
              y ="Distance From Home" ) + 
      theme(plot.title = element_text(size =12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none",
            legend.background = element_rect(fill="powderblue",size=0.5, linetype="solid",color="black")) 


title <- ggdraw() + draw_label("Distance from Home", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p77,p78, ncol = 2, labels = c("E", "F")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**E**
- Lot of Millenials Gen Y.2 within 10 Mile Radius.
- 30% Employee lived around 2 Miles Radius.

**F**
- Distance from Home doesn't seems like one of the attrition features among different Generations.

```{r}
# C. 
p79 <- ggplot(hr_df, aes(x =as.factor( DistanceFromHome)))+
      geom_bar(aes(y = (..count..)/sum(..count..),color = EmpDepartment, fill = EmpDepartment),alpha = 0.6,position = position_stack()) +
      scale_y_continuous(labels = percent) +
      theme_classic()+
      labs(x = "Distance from Home",
           y = "Percent \n") + 
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
      theme(legend.position = c(0.95, 0.95),legend.justification = c("right", "top"))

# D.
p80 <- hr_df %>%
       select(EmpDepartment, DistanceFromHome) %>%
       group_by(EmpDepartment) %>% 
       ggplot(aes(x=DistanceFromHome)) + 
       geom_density(aes(fill=EmpDepartment), alpha=0.8, show.legend=FALSE) +
       geom_vline(aes(xintercept=mean(DistanceFromHome)),color="red", linetype="dashed", size=1) +
       facet_wrap(~EmpDepartment) +
       theme_classic()+
       labs( x = "Distance from Home",
            y = "density \n") + 
       theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       annotate("text", label = "Avg_Mean \n 9.16", x = 20, y = 0.07, color = "red",size = 3)+
       theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
       scale_fill_manual(values=c("#B4EC6E", "#B86464","#0000FF", "#44154A","#262427", "#64E5DE"))

title <- ggdraw() + draw_label("Distance from Home Across Department", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p79,p80, ncol = 2,labels = c("G", "H")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))

```

**G**

- When We break it down by the department we don't see patterns of Attrition could be distance from Home.
- Three big departments have attrition more than any other departments.

**H**

- Except Data Science and Finance all departments employee have same pattern of living.

```{r}

# I. 
p81 <- hr_df %>% 
  group_by(Gender,DistanceFromHome) %>% 
  dplyr::summarise(count = n()) %>% 
  mutate(exp_pct = round(prop.table(count),2)*100) %>% 
  ggplot(aes(DistanceFromHome, y = exp_pct, fill=Gender)) +
  geom_bar(stat = "identity", position = position_stack())+
  coord_flip()+
  theme_classic()+
  labs(title = "By Gender",
        x = "DistanceFromHome \n",
        y = "Percentage (%)")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(plot.subtitle = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  geom_label(aes(label=paste0(exp_pct,"%")), color = "midnightblue", fontface = "bold.italic", size = 1.5,position = position_stack())+
  scale_fill_manual(values=c("hotpink","deep sky blue"))+
  theme(legend.position="none")

# J.
p82 <- hr_df %>% 
      select(EmpDepartment, Attrition,DistanceFromHome) %>% 
      group_by(Attrition, EmpDepartment) %>%
      ggplot(aes(x=EmpDepartment, y=DistanceFromHome, color=Attrition)) + 
      stat_summary(fun.y=mean, fun.ymin = min, fun.ymax = max) +
      geom_hline(aes(yintercept=mean(DistanceFromHome)),color="darkblue", linetype="dashed", size=1) +
      coord_flip() +
      theme_classic()+
      labs(title="Attrition", 
           x = "Department \n",
           y = "distance from Home")+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.text.x = element_text(angle = 90))+
      scale_color_manual(values=c("springgreen","tomato")) +
      theme(legend.position="none")

# K.
p83 <- hr_df %>% 
  group_by(Attrition,DistanceFromHome) %>% 
  dplyr::summarise(count = n()) %>% 
  mutate(exp_pct = round(prop.table(count),2)*100) %>% 
  ggplot(aes(DistanceFromHome, y = exp_pct, fill=Attrition)) +
  geom_bar(stat = "identity", position = position_stack())+
  coord_flip()+
  theme_classic()+
  labs(title = "Attrition Status",
        x = "DistanceFromHome \n",
        y = "Percentage (%)")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(plot.subtitle = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  geom_label(aes(label=paste0(exp_pct,"%")), color = "midnightblue", fontface = "bold.italic", size = 1.5,position = position_stack())+
  scale_fill_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Distance from Home", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p81,p82,p83, ncol = 3,labels = c("I", "J","K")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**I**

- Male and Female are equally distributed how far do they live from the Workplace.

**J**

- Most of them fall right in middle.

**K**

- Distance from the Home seems like Independent factor for Attrition.
- We can see their are some outliers based on their position but all outliers didn't left the company just because of commuting distance.

```{r}
p84 <- hr_df %>%
        select(EmpJobRole, DistanceFromHome, Attrition) %>%
        ggplot() + 
        geom_boxplot(aes(x=reorder(EmpJobRole, DistanceFromHome, FUN=median), #Median removes Outliers 
                       y=DistanceFromHome, fill=EmpJobRole)) + 
        coord_flip() + 
        facet_wrap(~Attrition) + 
        theme_classic() +
        labs( title="Attrition Status",
              x ="JobRole \n",
              y ="Distance From Home" ) + 
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(legend.position="none",
            legend.background = element_rect(fill="powderblue",size=0.5, linetype="solid",color="black")) 

p85 <- hr_df %>%
        select(EmpJobRole, DistanceFromHome,Gender) %>%
        ggplot() + 
        geom_boxplot(aes(x=reorder(EmpJobRole, DistanceFromHome, FUN=median), #Median removes Outliers 
                       y=DistanceFromHome, fill=EmpJobRole)) + 
        coord_flip() + 
        facet_wrap(~Gender) + 
        theme_classic() +
        labs( title="Gender Distribution",
              x ="JobRole \n",
              y ="Distance From Home" ) + 
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
      theme(axis.text.y = element_blank(), axis.title.y = element_blank())+
      theme(legend.position="none",
            legend.background = element_rect(fill="powderblue",size=0.5, linetype="solid",color="black")) 

title <- ggdraw() + draw_label("Distance from Home", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p84,p85, ncol = 2,labels = c("L", "M")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**L & M **
- One can make lot of Intrepretation based on Which Position Employee leave how far from the Workplace.
- And Also if the Employee is Male and Female and what's the trend look like based on Gender.

#<span style="color:red">**Business Travel**</span>

```{r}
# A.

p86 <- hr_df %>%
        select(EmpDepartment, BusinessTravelFrequency) %>%
        group_by(EmpDepartment, BusinessTravelFrequency) %>% 
        dplyr::summarize(count=n()) %>% 
        mutate(pct=round(prop.table(count),2) * 100) %>%
        ungroup(EmpDepartment, BusinessTravelFrequency) %>%
        ggplot(aes(x=EmpDepartment, y=pct, fill=BusinessTravelFrequency)) + 
        geom_bar(stat='identity') +
        coord_flip()+
        facet_wrap(~BusinessTravelFrequency) + 
        theme_solarized() + 
        labs(x="Gender", y="Percentage (%)") +
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_text(aes(x=EmpDepartment, label = paste0(count, sep = "")),
                    vjust =-1.5, hjust = 2.5,position = position_dodge(width = 1), size = 3, color = 'black',fontface = 'italic')+
        geom_label(aes(label=paste0(pct,"%"), fill = BusinessTravelFrequency),fontface = "bold.italic", size=3.5, color="black")+
        theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(axis.text.x=element_blank())+
        theme(legend.position="none")  

# B.

p87 <- hr_df %>%
        select(Gender, BusinessTravelFrequency) %>%
        group_by(Gender, BusinessTravelFrequency) %>% 
        dplyr::summarize(count=n()) %>% 
        mutate(pct=round(prop.table(count),2) * 100) %>%
        ungroup(Gender, BusinessTravelFrequency) %>% 
        ggplot(aes(x=Gender, y=pct, fill=BusinessTravelFrequency)) + 
        geom_bar(stat='identity') +
        coord_flip()+
        facet_wrap(~BusinessTravelFrequency) + 
        theme_solarized() + 
        labs(x="Gender", y="Percentage (%)") +
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_text(aes(x=Gender, label = paste0(count, sep = "")),
                    vjust =-1.5, hjust = 2.5,position = position_dodge(width = 1), size = 3, color = 'black',fontface = 'italic')+
        geom_label(aes(label=paste0(pct,"%"), fill = BusinessTravelFrequency),fontface = "bold.italic", size=3.5, color="black")+
        theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(axis.text.x=element_blank())+
        theme(legend.position="none")  

title <- ggdraw() + draw_label("Business Travel Frequency", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p86,p87, ncol = 2,labels = c("A", "B")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**A**
- Seems like in each department most of the Employee do travel rarely.

**B**
- When we break it down by Male and Female we see same proportion in all 3 groups.

```{r}
# C.

p88 <- hr_df %>%
        select(BusinessTravelFrequency,Attrition) %>%
        group_by(BusinessTravelFrequency,Attrition) %>% 
        dplyr::summarize(count=n()) %>% 
        mutate(pct=round(prop.table(count),2) * 100) %>%
        ungroup(BusinessTravelFrequency,Attrition) %>% 
        ggplot(aes(x=Attrition, y=pct, fill=BusinessTravelFrequency)) + 
        geom_bar(stat='identity') +
        coord_flip()+
        facet_wrap(~BusinessTravelFrequency) + 
        theme_solarized() +  
        labs(x="Attrition", y="Percentage (%)") +
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_text(aes(x= Attrition, label = paste0(count, sep = "")),
                    vjust =-1.5, hjust = 2.5,position = position_dodge(width = 1), size = 3, color = 'black',fontface = 'italic')+
        geom_label(aes(label=paste0(pct,"%"), fill = BusinessTravelFrequency),fontface = "bold.italic", size=3.5, color="black")+
        theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(axis.text.x=element_blank())+
        theme(legend.position="none")   

# D.

p89 <- hr_df %>%
        select(Attrition, BusinessTravelFrequency, MaritalStatus) %>%
        group_by(BusinessTravelFrequency,MaritalStatus) %>% 
        dplyr::summarize(count=n()) %>% 
        mutate(pct=round(prop.table(count),2) * 100) %>%
        arrange(desc(pct)) %>% 
        ungroup(BusinessTravelFrequency,MaritalStatus) %>% 
        ggplot(aes(x=MaritalStatus, y=pct, fill=BusinessTravelFrequency)) + 
        geom_bar(stat='identity') +
        coord_flip()+
        facet_wrap(~BusinessTravelFrequency) + 
        theme_solarized() +  
        labs(x="Attrition", y="Percentage (%)") +
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_text(aes(x= MaritalStatus, label = paste0(count, sep = "")),vjust =-1.5, hjust =2.5,position = position_dodge(width = 1), size = 3, color = 'black', fontface = 'italic')+
        geom_label(aes(label=paste0(pct,"%"),fill = BusinessTravelFrequency),fontface = "bold.italic",size=3.5, color="black")+ 
        theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(axis.text.x=element_blank())+
        theme(legend.position="none") 



title <- ggdraw() + draw_label("Business Travel Frequency Attrition", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p88,p89, nrow =2,labels = c("C", "D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.1, 1, 1))
```

**C**
- Travel Frequently groups tend to leave the company compare to rarely and non travel.

**D**
- Travel Rarely comprises mostly Married Person and least comprise of Divorced Employee similar is the case with Travel Frequently.

#<span style="color:red">**Hourly Income**</span>


i. Hourly Income | Gender | Department


```{r}
# Highest paid position
hr_df %>% 
  select(EmpHourlyRate, EmpJobRole, Gender) %>%
  group_by(EmpHourlyRate,EmpJobRole, Gender) %>% 
  summarise(count = n()) %>% 
  arrange(desc(EmpHourlyRate)) %>%  head(10) %>% kable(caption = "Highest Paid Position")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")
```


```{r}
summary(hr_df$EmpHourlyRate~ hr_df$Gender) 

# A. By Gender

p90 <- hr_df %>% 
  select(Gender, EmpHourlyRate,EmpDepartment) %>%
  group_by(Gender) %>% 
  dplyr::summarise(avg_income=round(median(EmpHourlyRate), 3)) %>%
  ggplot(aes(x=Gender, y=avg_income)) + 
  geom_bar(stat="identity", fill=c("hotpink","deep sky blue"), width=0.5) + 
  coord_flip() +
  theme_solarized() + 
  labs(title=" Median $ By Gender",
       x="Gender \n",
       y="Median Hourly Rate $") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x=Gender, y=0.01, label= paste0("$ ", avg_income)), hjust=-1, vjust=0, size=4,color="black", fontface = "bold",angle=360)+
  theme(panel.grid.major = element_line("white"), 
              panel.grid.minor = element_line("white"))

# B. Across the department

p91 <- hr_df %>% 
  select(EmpDepartment,EmpHourlyRate) %>% 
  group_by(EmpDepartment) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ungroup(EmpDepartment) %>% 
  ggplot(aes(x=EmpDepartment, y=avg_inc, fill =EmpDepartment )) + 
  geom_bar(stat="identity", position="dodge") + 
  coord_flip()+
  theme_solarized() +
  labs(x="Department \n",
       y="Median Hourly Rate $", 
       title="Median Hourly Rate") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = EmpDepartment, y = 1, label = paste0("$ ",round(avg_inc,2))),hjust=-0.5, vjust=.5, size = 4, color =   'midnightblue',fontface = 'bold',angle=360)+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position="none")

# C. By Gender

p92 <- hr_df %>% 
  select(Gender, EmpHourlyRate,EmpDepartment) %>%
  group_by(Gender) %>% 
  dplyr::summarise(avg_mean_income=round(mean(EmpHourlyRate), 3)) %>%
  ggplot(aes(x=Gender, y=avg_mean_income)) + 
  geom_bar(stat="identity", fill=c("hotpink","deep sky blue"), width=0.5) + 
  coord_flip() +
  theme_solarized() + 
  labs(title="Mean $ By Gender",
       x="Gender \n",
       y="Mean Hourly Rate $") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x=Gender, y=0.01, label= paste0("$ ", avg_mean_income)), hjust=-1, vjust=0, size=4,color="black", fontface = "bold",angle=360)+
  theme(panel.grid.major = element_line("white"), 
              panel.grid.minor = element_line("white"))

# D. Across the department

p93 <- hr_df %>% 
  select(EmpDepartment,EmpHourlyRate) %>% 
  group_by(EmpDepartment) %>%
  dplyr::summarize(avg_inc_mean=mean(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc_mean)) %>% 
  ungroup(EmpDepartment) %>% 
  ggplot(aes(x=EmpDepartment, y=avg_inc_mean, fill =EmpDepartment )) + 
  geom_bar(stat="identity", position="dodge") + 
  coord_flip()+
  theme_solarized() +
  labs(x="Department \n",
       y="Mean Hourly Rate $", 
       title="Mean Hourly Rate") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = EmpDepartment, y = 1, label = paste0("$ ",round(avg_inc_mean,2))),hjust=-0.5, vjust=.5, size = 4, color =   'midnightblue',fontface = 'bold',angle=360)+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Mean and Median Hourly Rate Distribution ", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p90,p91,p92,p93, nrow = 2,labels = c("A", "B","C","D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))

```

**A**

- Is it True that Male tends to make less compare to Female.There is a dollar difference in an  Median hourly Rate?
- On Average Male and Female throughout the organisation makes more or less around $67 an hour.

**B**

- When we break it down by the Department we can see their is variation.
- Finance Employee on Average tends to make more and HR employee tends to make Less per hour if we look Median Hourly Rate.

**C**

- If we took Overall Mean we see Male making $66.02 compare that to Female $65.93.Seems like there is barely any difference.

**D**

- DS Employee seems to be on low end compare to Rest of the Department.

```{r}
# E.
# ii.HourlyRate |  Gender | EmpDepartment

p94 <- hr_df %>% 
  select(EmpDepartment,EmpHourlyRate, Gender) %>% 
  group_by(EmpDepartment,Gender) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ungroup(EmpDepartment,Attrition) %>% 
  ggplot(aes(x=EmpDepartment, y=avg_inc, fill =EmpDepartment )) + 
  geom_bar(stat="identity", position="dodge") + 
  facet_wrap(~Gender)+
  coord_flip()+
  theme_solarized() +
  labs(x="Department \n",
       y="Median Hourly Rate", 
       title=" Across the department by Gender") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = EmpDepartment, y = 1, label = paste0("$ ",round(avg_inc,2))),hjust=-0.5, vjust=.5, size = 4, color =   'midnightblue',fontface = 'bold',angle=360)+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position="none")

# F.
p95 <- ggplot(hr_df, aes(x=Gender, y=EmpHourlyRate, color=Gender, fill=Gender)) +
  geom_boxplot() +
  facet_grid(~EmpDepartment) +
  coord_flip() + 
  theme_solarized() +
  labs(title ="Gender Disparities in Hourly Income based on Department", x = "Gender \n ", y = "Median Hourly Rate")+
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  scale_fill_manual(values=c("hotpink","deep sky blue")) +
  scale_color_manual(values=c("hotpink","deep sky blue")) +
  theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position = "none")

title <- ggdraw() + draw_label("Median Hourly Rate", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p94,p95, nrow = 2,labels = c("E", "F")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**E**

- When we even break it down by Department and Gender we can see some disparities.
- Taking Median Hourly Income is not affected by Outliers which we can see in Human Resource Department.
- When we break it down by the Gender and Department now we can see the Wage disparities.
- There is Huge difference in Human Resource Department, Male making around $71/hr compare to Female $50/hr.
- In Sales Female tends to make $70/hr comapre to Male $62/hr
- In Finance Female tends to make $68.5/hr comapre to Male $76/hr
- But it won't be True until and unless we consider same Job Role position and Work Experience to make that judgement.

**F**

- In box plot we can see only outlier which is present in Human Resource Department but there are no any outliers in any other department to make that call.


```{r}
# G.

p96 <- hr_df %>% 
  select(EmpJobRole,EmpHourlyRate, Gender) %>% 
  group_by(EmpJobRole,Gender) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
 # ungroup(EmpJobRole,Attrition) %>% 
  ggplot(aes(x=EmpJobRole, y=avg_inc, fill =EmpJobRole )) + 
  geom_bar(stat="identity", position=position_stack()) + 
  facet_wrap(~Gender)+
  coord_flip()+
  theme_solarized() +
  labs(x="Department \n",
       y="Hourly Rate", 
       title=" Department by Gender") + 
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = EmpJobRole, y = 1, label = paste0("$ ",round(avg_inc,2))),hjust=-1, vjust=0.5, size = 2.5, color =   'midnightblue',fontface = 'bold',angle=360,position=position_stack())+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position="none")

# H.
p97 <- hr_df %>% 
  select(Generation,EmpHourlyRate, Gender) %>% 
  group_by(Generation,Gender) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
 # ungroup(EmpJobRole,Attrition) %>% 
  ggplot(aes(x=Generation, y=avg_inc, fill =factor(Generation) )) + 
  geom_bar(stat="identity", position=position_stack()) + 
  facet_wrap(~Gender)+
  coord_flip()+
  theme_solarized() +
  labs(x="Generation \n",
       y="Hourly Rate", 
       title="Generation") + 
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = Generation, y = 1.5, label = paste0("$ ",round(avg_inc,2))),hjust=-0.5, vjust=.5, size = 2.5, color =   'black',fontface = 'bold',angle=360,position=position_stack())+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Median Hourly Rate", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p96,p97, ncol = 2,labels = c("G", "H"), rel_widths = c(0.60,0.40)) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))

```

**G**

- When considering breaking it down by the Job Role it makes more sense as we can see the variation among the Gender.
- In Some of the Role Female tends to make more than Male and in Some Field Male tends to make more than Female.
- Another factor that need to be reconsider before we make assumption is Years of Experience and their Education level.
- Its harder to compare and reach out to conclusion until and unless we compare apples to apples.
- Variablity factor could be Years of Experience either in current Job or Past Experience, Education level.

**H**

- Baby Boomers(Age: ) makes more money which does make sense.
- Male Millenials Y.1 makes less money even compare to Female Millenials Y.1.


```{r}
p98 <- hr_df %>% 
      select(EmpDepartment,EmpHourlyRate, Attrition) %>% 
      group_by(EmpDepartment, Attrition) %>%
      dplyr::summarize(Med=median(EmpHourlyRate)) %>%
      ggplot(aes(x=EmpDepartment, y=Med, color=Attrition)) + 
      geom_point(size=3) + 
      geom_segment(aes(x=EmpDepartment,xend=EmpDepartment, y=0,yend=Med)) +
      coord_flip() +
      theme_economist() + 
      labs(title="Attrition by Hourly Rate $",
            x= "Department \n",
            y="Median Hourly Rate") +
      theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      scale_color_manual(values=c("springgreen","tomato")) + 
       theme(legend.position="none")

p99 <- ggplot(hr_df,aes(x=EmpDepartment, y=EmpHourlyRate, color = Gender, fill = Gender)) +
 geom_boxplot() +
 geom_hline(aes(yintercept=median(EmpHourlyRate)),color="darkblue", linetype="dashed", size=1) +
 coord_flip()+
 theme_economist() + 
 labs(title ="Gender Disparities in Hourly Income", y = "Median Hourly Rate", x = "Department \n")+
 theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
 theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
 theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
 scale_fill_manual(values=c("hotpink","deep sky blue")) +
 scale_color_manual(values=c("hotpink","deep sky blue")) +
  theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
 theme(legend.position="none")

p100 <- hr_df %>% 
  select(Age_bin,EmpHourlyRate) %>% 
  group_by(Age_bin) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ungroup(EmpDepartment,Attrition) %>% 
  ggplot(aes(x=Age_bin, y=avg_inc, fill = Age_bin)) + 
  geom_bar(stat="identity", position="dodge") + 
  coord_flip()+
  theme_economist() + 
  labs(x="Age_bin \n",
       y="Median Hourly Rate", 
       title="Across Age Group") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = Age_bin, y = 1, label = paste0("$ ",round(avg_inc,2))),
                hjust=-0.5, vjust=.5, size = 2.5, color = 'midnightblue',fontface = 'bold',angle=360)+
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(legend.position="none")


p101 <- hr_df %>% 
  select(Age_bin, Gender,EmpHourlyRate) %>% 
  group_by(Age_bin,Gender) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ungroup(EmpDepartment,Attrition) %>% 
  ggplot(aes(x=Age_bin, y=avg_inc, fill = Gender)) + 
  geom_bar(stat="identity", position=position_dodge2(width = 1)) + 
  coord_flip()+
  theme_economist() + 
  labs(x="Age_bin \n",
       y="Median Hourly Rate", 
       title="Age Group by Gender") + 
  theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = Age_bin, y = 1, label = paste0("$ ",round(avg_inc,2))),
                hjust=-0.5, vjust=.5,position=position_dodge(width=0.9), size = 2.5, color = 'midnightblue',fontface =   'bold',angle=360)+
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  scale_fill_manual(values=c("hotpink","lightblue")) + 
  scale_color_manual(values=c("hotpink","lightblue")) +
  theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Age Disribution", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p98,p99,p100,p101, nrow = 2,labels = c("I", "J","K","L")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))

```


**I**

- Is Hourly Rate a Reason for Employees to Leave Department?
- In Some it could be the case but in some it's Not. In Finance Employee doesn't seem to live just by Hourly Rate. In others there could be possibility.

**J**

- We can see Gender Disparities between Genders across Department.

**K**

- When we break it down by Age group as Employee Age they tend to get paid better, which could be becuase of Senior Role or Experience.

**L**

- When we break those age group by Gender we can see the Male of Age below 20 seems to be paid badly compared to Female of same Age group.

```{r}
p102 <- hr_df %>% 
  select(EmpJobRole,EmpHourlyRate,Attrition) %>% 
  group_by(EmpJobRole, Attrition) %>%
  dplyr::summarize(avg_inc=median(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg_inc, fill =Attrition )) + 
  geom_bar(stat="identity", position=position_stack()) + 
  facet_wrap(~Attrition)+
  coord_flip()+
  theme_economist() + 
  labs(x="Job Role \n",
       y="Median Hourly Rate")+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(x = EmpJobRole, label = paste0("$ ",round(avg_inc,2))),hjust=0.5, vjust=0.5, size = 2.5, color =   'midnightblue',fontface = 'bold', position=position_stack())+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
   scale_fill_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")


p103 <- hr_df %>% 
      select(EmpJobRole,EmpHourlyRate, Attrition) %>% 
      group_by(EmpJobRole, Attrition) %>%
      dplyr::summarize(Med=median(EmpHourlyRate)) %>%
      ggplot(aes(x=EmpJobRole, y=Med, color=Attrition)) + 
      geom_point(size=3) + 
      geom_segment(aes(x=EmpJobRole,xend=EmpJobRole, y=0,yend=Med)) +
      coord_flip() +
      theme_economist() + 
      labs(title="Hourly Rate Attrition",
            x= "Job Role \n",
            y="Median Income") +
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.text.x = element_text(angle=65, vjust=0.6),plot.title=element_text(hjust=0.5),
            strip.background = element_blank(),strip.text = element_blank()) + 
      scale_color_manual(values=c("springgreen","tomato")) + 
      geom_text(aes(x=EmpJobRole, y=0.01,label= paste0("$ ")),hjust=-0.5,vjust=-0.5, size=4, color="midnightblue", fontface ="italic", angle=360)+
  theme(axis.title.y = element_blank(), axis.text.y = element_blank())+
      theme(legend.position="none")

title <- ggdraw() + draw_label("Median Hourly Rate", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p102,p103, ncol = 2,labels = c("M", "N"), rel_widths = c(0.60,0.40)) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

**M & N **

- The difference between Employee Leaving the company to staying is very Minimal. 
- As this is calculated in hourly Rate, it could rack up huge when you calculated yearly.

```{r}
p104 <- hr_df %>% 
  group_by(TotalWorkExperienceInYears,Attrition) %>% 
  dplyr::summarise(count = n()) %>% 
  mutate(exp_pct = round(prop.table(count),2)*100) %>% 
  ggplot(aes(TotalWorkExperienceInYears, y = exp_pct, fill=Attrition)) +
  geom_bar(stat = "identity", position = position_stack())+
  coord_flip()+
  theme_economist() + 
  labs(title = "By Attrition",
        x = "Experience Years In Current-Role \n",
        y = "Percentage (%)")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=0.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=0.5,hjust=0.5)) +
  geom_label(aes(label=paste0(exp_pct,"%")), color = "midnightblue", fontface = "bold.italic", size =1.5,position = position_stack(),hjust=0.5,vjust=0.5)+
  scale_fill_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")

p105 <- hr_df %>% 
      select(Gender,TotalWorkExperienceInYears, Attrition) %>% 
      group_by(Gender, Attrition) %>%
      dplyr::summarize(Med=median(TotalWorkExperienceInYears)) %>%
      ggplot(aes(x=reorder(Gender, -Med), y=Med, color=Attrition)) + 
      geom_point(size=3) + 
      geom_segment(aes(x=Gender,xend=Gender, y=0,yend=Med)) +
      coord_flip() +
      theme_economist() + 
      labs(title="By Gender",
            x= "Gender \n",
            y="Total_Work_Exp(Yrs)") +
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.text.x = element_text(angle=65, vjust=0.6),plot.title=element_text(hjust=0.5),
            strip.background = element_blank(),strip.text = element_blank()) + 
      scale_color_manual(values=c("springgreen","tomato")) + 
      geom_text(aes(x=Gender, y=0.01,label= paste0("$ ")),hjust=-0.5,vjust=-0.5, size=4, color="midnightblue", fontface ="italic", angle=360)+
      theme(legend.position="none")



title <- ggdraw() + draw_label("Total WorkExperience In Years", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p104,p105, ncol = 2, labels = c("O", "P"),rel_heights = c(1, 0.5),rel_widths =  c(0.70, 0.30),scale = 0.98) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))

```

**O**

- One can generalise how Work Experience might count on Employee to either leave or stay.
- We can see that as we move up Experience in years we see more green except one outlier which could possible be retired or death or could left for better opportunities and money.
- But overall as someone has more work experience they seem to stay rather than leave.

**P**

- In both gender we can see that more you spent gaining more experience you are more likely to not leave the company. 

#<span style="color:red">**Salary Hike Percent**</span>

i.  Salary Hike Percent across Department
ii. Salary Hike Percent across age & Dept.
iii. Salary Hike Percent segregated by Gender
iv. Salary Hike Percent segregated by Attrition
v. Percent Hike and attrition between gender ( iii + v )

```{r}
p106 <- ggplot(hr_df, aes(x = EmpLastSalaryHikePercent))+ 
  geom_histogram(aes(y = ..density..,color = Gender,fill = Gender),alpha = 0.2,position = "identity",bins = 30) + 
  geom_density(aes(color = Gender), size =1)+
  theme_classic()+
  labs(title="LastSalaryHikePercent",
        x = "LastSalaryHikePercent",
        y = "Density \n") +
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  scale_fill_manual(values=c("hotpink","deep sky blue")) +  
  scale_color_manual(values=c("hotpink","deep sky blue")) +
  theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
  theme(legend.text=element_text(size=8),
        legend.position = "top",
        legend.box = "horizontal",
        legend.title=element_blank())

p107 <- ggplot(hr_df, aes(x = EmpLastSalaryHikePercent))+ 
  geom_histogram(aes(y = ..density..,color = EmpDepartment,fill = EmpDepartment),alpha = 0.2,position = "identity",bins = 30) + 
  geom_density(aes(color = EmpDepartment), size =1)+
  theme_classic()+
  labs(title="EmpLastSalaryHikePercent",
        x = "EmpLastSalaryHikePercent",
        y = "Density \n") +
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
   theme(panel.grid.major = element_line("white"), panel.grid.minor = element_line("white"))+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
     theme(legend.text=element_text(size=8),
        legend.position = "top",
        legend.box = "horizontal",
        legend.title=element_blank())

title <- ggdraw() + draw_label("Comparison of Salary Hike Percent by Department & Gender", fontface='bold', colour = "red")
bottom_row <- plot_grid(p106, p107, ncol = 2, labels = c("A","B"), scale = 0.97)
plot_grid(title, bottom_row, nrow = 2, labels = c("", "", "C"),
          rel_heights = c(0.05, 1, 1))

```

**A**

- We have Salary Hike Percentage ranging from 11% to 25% . If you see its Left Skewed meaning there is more probability that you will have 11-14% of Salary Hike percentage in the beginning and then it slows down. 
- If you see the Department we can see Data Science Department(Blue line) stands out than other departments.


**B**

- There is no bias in Salary Hike Percentage based on Gender.

```{r}
p108 <-ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill = EmpDepartment)) +
        geom_violin(alpha=0.6) +
        coord_flip()+
        facet_wrap(~Attrition)+
        theme_minimal()+
        labs(title = "Across Dept & Attrition", x= "Department \n", y = "Hike %")+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(panel.grid.major = element_line("white"), 
              panel.grid.minor = element_line("white"))+ 
        theme(legend.position="none")

# iv. Across Department by Attrition
p109 <- ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill=Gender)) +
         geom_violin(alpha=0.6) +
         coord_flip()+
         facet_wrap(~Attrition)+
         theme_minimal()+
         labs(title = "Across Dept, Gender & Attrition", x= "Department \n", y = "Hike %")+
         theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
         theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
         theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
         scale_fill_manual(values=c("hotpink","deep sky blue")) + 
         scale_color_manual(values=c("hotpink","deep sky blue")) + 
         theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(axis.text.y=element_blank())+
        theme(panel.grid.major = element_line("white"), 
              panel.grid.minor = element_line("white"))+ 
        theme(legend.position="none")

title <- ggdraw() + draw_label("Salary Hike Percentage(%)", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p108,p109, nrow = 1,labels = c("C", "D")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))

```

**C**

- How does Salary Hike Percentage helps Employee to either stay or leave the company.
- When we break it down by Department we can see in Finance more than 15% and less than 20% have keep the employee to work.
- In Data Science Department Increase Salary has kept employee to not leave the company.

**D**

- In Finance department Salary Hike Percentage more than 15 and less than 20 % has kept all to work.
- In Data Science field Employee doesnt seem to leave if there is Salary Hike which can be seen in both Gender.
- In Finance all the employee who left beside Salary Hike Percent are all Male.
- In Finance may be if there is Salary Hike Percent, we can keep most of the Female employee from leaving the company.

```{r}

p110 <- ggplot(hr_df, aes(EmpLastSalaryHikePercent, PerformanceRating, colour = Attrition)) +
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  theme(legend.position = "bottom", legend.box = "horizontal") +
  guides(color = guide_legend(nrow = 1))+
  theme_solarized()+
        labs(title = "By Attrition", x= "Hike (%)", y = "Performance Rating \n")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"))+
        scale_fill_manual(values=c("springgreen","tomato")) + 
        scale_color_manual(values=c("springgreen","tomato")) + 
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
    theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(legend.position="none")

p111 <- ggplot(hr_df, aes(EmpLastSalaryHikePercent, PerformanceRating, colour = Gender)) +
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  theme(legend.position = "bottom", legend.box = "horizontal") +
  guides(color = guide_legend(nrow = 1))+
  theme_solarized()+
        labs(title = "By Gender", x= "Hike (%)", y = "Performance Rating \n ")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"))+
        scale_fill_manual(values=c("hotpink","deep sky blue")) + 
        scale_color_manual(values=c("hotpink","deep sky blue")) + 
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(legend.position="none")


title <- ggdraw() + draw_label("Comparison of Salary Hike Percent to Performance Rating", fontface='bold', colour = "red")
bottom_row <- plot_grid(p110, p111, ncol = 2, labels = c("E","F"), scale = 0.97)
plot_grid(title, bottom_row, nrow = 2, labels = c("", "", "C"),
          rel_heights = c(0.05, 1, 1))

```

**E**

- Overall as performance rating increases the Salary Hike Percentage does increase.

**F**

- Highest Performance Rating does have edge over Hike Percentage those who stays and those who leave.


```{r}
p112 <- ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill=EmpDepartment)) +
        geom_violin(alpha=0.8) +
        coord_flip()+
        facet_grid(~Generation)+
        theme_economist()+
        labs(title = "By Generation", x= "Department\n", y = "Salary Hike Percent \n ")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(legend.position="none")

p113 <- ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill=EmpDepartment)) +
        geom_violin(alpha=0.8) +
        coord_flip()+
        facet_grid(~Age_bin)+
        theme_economist()+
        labs(title = "By Age", x= "Department", y = "Salary Hike Percent \n ")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
    theme(axis.text.y = element_blank(), axis.title.y = element_blank())+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(legend.position="none")

title <- ggdraw() + draw_label("Salary Hike Percentage(%)", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p112,p113, nrow = 1,labels = c("G", "H"), scale = 0.97) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**G**

- Baby Boomers(Age:55 -76) in Data Science and Finance field doesn't get Hike % compare to rest of the department.
- We can see segregation in HR Millenials Gen Y.2.

**H**

- We can see some of the interesting features in HR for Employee Age between 20_30 and In Finance between Age 40_50.

```{r}
p114 <- ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill=EmpDepartment)) +
        geom_violin(alpha=0.8) +
        coord_flip()+
        facet_grid(~MaritalStatus)+
        theme_wsj()+
        labs(title = "By MaritalStatus", x= "Hike (%) \n", y = "Performance Rating \n ")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(legend.position="none")

p115 <- ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill=EmpDepartment)) +
        geom_violin(alpha=0.8) +
        coord_flip()+
        facet_grid(~Educational_Levels)+
        theme_wsj()+
        labs(title = "By Educational_Levels", x= "Hike (%)", y = "Performance Rating \n ")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(strip.text = element_text(face="bold", size=4.5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
    theme(axis.text.y = element_blank(), axis.title.y = element_blank())+
  theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(legend.position="none")

title <- ggdraw() + draw_label("Salary Hike Percentage(%)", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p114,p115, nrow = 1,labels = c("I", "J"), scale = 0.97) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**I**

- Three big department doesn't care so much about Salary Hike based on our Martial Status.
- In Data Science field we can see Martial Status has some influence.Single are restricted to 20% Hike. Married Employee gets 15% to 20% Hike and flattens out. Divorced are restricted to 20 % 
- In Finance Singles are restricted to 20% Salary Hike.

**J**

- If we look how does the education level have helped employee to get more salary hike percent, we can see again interesting pattern in Data Science department.
- No college Degree and PhD employee doesnt get any salary increment.
- In Finance we can see segregation in PhD Employee. There are employee who get Salary Hike Percent around 15% and then there are very few Employee who gets around 25%.
- One can say it might depend upon Job Role and experience than education which we can look by Job Role.

```{r}
# Job Role'

p116 <- hr_df %>% 
      select(EmpJobRole, EmpLastSalaryHikePercent) %>% 
      group_by(EmpJobRole, EmpLastSalaryHikePercent) %>%
      dplyr::summarize(Med=median(EmpLastSalaryHikePercent)) %>%
      ggplot(aes(x=EmpJobRole, y=Med, color=factor(EmpLastSalaryHikePercent))) + 
      geom_point(size=3) + 
      geom_segment(aes(x=EmpJobRole,xend=EmpJobRole, y=0,yend=Med)) +
      coord_flip() +
      theme_economist() + 
      labs(x= "Job Role \n",
           y="Hike (%)") +
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.text.x = element_text(angle=65, vjust=0.6),plot.title=element_text(hjust=0.5),
            strip.background = element_blank(),strip.text = element_blank()) + 
      geom_text(aes(x=EmpJobRole, y=0.01,label= paste0("$ % ")),hjust=-0.5,vjust=-0.5, size=4, color="midnightblue", fontface ="italic", angle=360)+
      theme(legend.position="none")


title <- ggdraw() + draw_label("Salary Hike Percentage(%)", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p116, nrow = 1,labels = "K", scale = 0.97) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**K**

- Median hike percentage.
- All the job Roles start at 11% Hike except Delivery manager and Technical Architect who gets 12% Hike.
- There are some jobs which gets more Hike % than others.
- Developer & Sales Executive have variation in  Hike % more than any other jobs.

```{r}
# PerformanceRating
p117 <- ggplot(hr_df, aes(x=EmpDepartment, y=EmpLastSalaryHikePercent, fill=EmpDepartment)) +
        geom_violin(alpha=0.8) +
        coord_flip()+
        facet_grid(~PerformanceRating)+
        theme_solarized()+
        labs(title = "PerformanceRating", x= "Department \n", y = "Hike (%)")+
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(plot.margin=unit(c(0,0,1,1),"points"))+
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(legend.position="none")

# v. Percent Hike and attrition between gender 

p118 <- hr_df %>% 
        select(Attrition,EmpLastSalaryHikePercent, EmpHourlyRate,EmpDepartment, Gender) %>% 
        ggplot(aes(x=EmpLastSalaryHikePercent, y= EmpHourlyRate)) + 
        geom_jitter(aes(col=Attrition), alpha=0.5) + 
        facet_wrap(~ Gender) +
        theme_tufte() + 
        labs(title="Attrition by Gender", x= "Hike (%)", y = "Hourly Rate \n") +
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+ 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_color_manual(values=c("springgreen","tomato")) + 
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1,hjust=0.5,face="italic")) +
        theme(axis.text.x=element_text(colour="black"),
              axis.text.y=element_text(colour="black"))+
        theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
        theme(legend.position="none")

title <- ggdraw() + draw_label("Salary Hike Percentage(%)", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p117,p118, nrow = 2,labels = c("L", "M")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**L**

- When we try to break it down by Department we can see Interesting patterns
- Data Science Employees have performance Rating of only 3.
- Their Salary Hike Percentage is maximum upto 20%.
- Either Low or High Performance Rating Data Scinetist doesnt get any Salary Hike Percentage.
- For rest of the Department even if you have low Performance rating you still can get upto 25% Salary hike.
- If you have Performance Rating of 4 majority of the employee gets more than 20% Salary Hike.


**M**

- As we have more Male Employee we can see Attrition has been condensed in Male Employee whereas it has been spread out in Female.

```{r}

# formattable(sample_n(hr_df, 2),align="l",list(Gender=color_tile("lightsalmon","green"),EducationBackground=color_bar("cyan"),EmpJobRole=color_bar("darkorchid"),style = ~ style(color = "black",font.weight = "bold")))

a <- hr_df %>% 
  select(Gender,Age_bin,Hike_Pct) %>% 
  ftable() %>% 
  prop.table() %>% {. * 100} %>% round(2) %>% data.frame() 
  
as.datatable(formattable(a, align  = "l",list (Hike_Pct = color_bar("cyan"),style = ~ style(color = "black",font.weight = "bold"))))

b <- hr_df %>% 
  select(EmpDepartment,Hike_Pct) %>% 
  ftable() %>% 
  prop.table() %>% {. * 100} %>% round(2) %>% data.frame() 

as.datatable(formattable(b, align  = "l",list (Hike_Pct = color_bar("cyan"),style = ~ style(color = "black",font.weight = "bold"))))

c <- a %>% filter(Gender == "Male")
c[c$Freq == max(c$Freq), ]

d <- a %>% filter(Gender == "Female")
d[d$Freq == max(d$Freq), ]
```

**Select by Freq**

- In our datasets about 9.92% of Employee of Male Age between 30-40 have got 14-16% Salary Hike.
- In our datasets about 5.42% of Employee of Female Age between 30-40 have got 11-13% Salary Hike as we don't have equal number of Males and Female in our datasets it makes sense. It doesnt mean that there is any biases as we have shown in bar plot chart that they are treated equally interms of hike Percentage.
- 

- In our datasets about 11.17% of Employee from Sales Department got 14-16% Salary Hike which is the biggest.
- In our datasets about 10.50% of Employee from Development Department got 14-16% Salary Hike which is the biggest.
- In our datasets about 10.17% of Employee from R&D Department got 14-16% Salary Hike which is the biggest.

#<span style="color:red">**ATTRITION**</span>

Our main question for doing all this Exploratory data analysis beside finding the Relationhsip between the variables is also to understand the Attrition Rates and diagnose the cause and find useful insights. Lets look at the Attrition Number of our datasets.


##<span style="color:magenta">**Attrition by Age**</span>


```{r}
p119 <- hr_df %>%
       select(Attrition, Age) %>%
       group_by(Age) %>% 
       ggplot(aes(x=Age)) + 
       geom_density(aes(fill=Attrition), alpha=0.8, show.legend=FALSE) +
       theme_economist()+
       labs(x = "Age", y = "density \n")+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_vline(aes(xintercept=mean(Age)),color="red", linetype="dashed", size=1) +
      scale_color_manual(values=c("springgreen","tomato")) + 
  scale_fill_manual(values=c("springgreen","tomato"))+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position = "bottom")

p120 <- hr_df %>%
       select(Attrition, Age,EmpDepartment) %>%
       group_by(Age,EmpDepartment) %>% 
       ggplot(aes(x=Age)) + 
       geom_density(aes(fill=Attrition), alpha=0.8, show.legend=FALSE) +
       facet_grid(~EmpDepartment) +
       theme_economist()+
       labs(x = "Age", y = "density \n")+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_vline(aes(xintercept=mean(Age)),color="red", linetype="dashed", size=1) +
  scale_color_manual(values=c("springgreen","tomato")) + 
  scale_fill_manual(values=c("springgreen","tomato"))+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position = "bottom")

title <- ggdraw() + draw_label("Relationshiop between Age and Attrition", fontface='bold', size=12, colour = "red")
bottom_row <-plot_grid(p119,p120, nrow = 2, labels = c("A", "B"),scale = 0.97)

plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 0.5, 0.5))
```

**A**

- As we have look into all the components, now its time to see how is the attrition distrbuted across various variables.
- In Finance department we can see the younger Employee seems to leave the company.
- In Data Science also we can see clear differentiation.
- In Human Resource we can also early retention but after mean age they are less likely to leave the company.
- Looking through out the department.

**B**

-Younger Employee tends to leave the company than to stay.
- After Age 35 we can see more Employees tends to stay than to leave the company could be because of Financial Stability and years of experience to settle down.


```{r}
p121 <- hr_df %>%
       select(Attrition, Age,MaritalStatus) %>%
       group_by(MaritalStatus, Age) %>% 
       ggplot(aes(x=Age)) + 
       geom_density(aes(fill=Attrition), alpha=0.8, show.legend=FALSE) +
       facet_grid(~MaritalStatus) +
       theme_economist()+
       labs(x = "Age", y = "density \n")+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_vline(aes(xintercept=mean(Age)),color="red", linetype="dashed", size=1) +
       scale_color_manual(values=c("springgreen","tomato")) + 
       scale_fill_manual(values=c("springgreen","tomato"))+
       theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position = "bottom")

p122 <- hr_df %>%
       select(Attrition, Age,Educational_Levels) %>%
       group_by(Educational_Levels, Age) %>% 
       ggplot(aes(x=Age)) + 
       geom_density(aes(fill=Attrition), alpha=0.8, show.legend=FALSE) +
       facet_grid(~Educational_Levels) +
       theme_economist()+
       labs(x = "Age", y = "density \n")+
       theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
       geom_vline(aes(xintercept=mean(Age)),color="red", linetype="dashed", size=1) +
  scale_color_manual(values=c("springgreen","tomato")) + 
  scale_fill_manual(values=c("springgreen","tomato"))+
      theme(strip.text = element_text(face="bold", size=7),strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position = "bottom")

title <- ggdraw() + draw_label("Relationshiop between Age and Attrition", fontface='bold', size=12, colour = "red")
bottom_row <-plot_grid(p121,p122, nrow = 2, labels = c("C", "D"),rel_heights = c(0.5, 0.5),rel_widths =  c(0.5, 0.5),scale = 0.97)

plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1, 1))
```

**C**

- Interesting Features in education level PhD.Rest of the education levels is somewhat more or less similar.

**D**

- Martial status does have some effect on Attrition.Just look at geom density between Single and rest.

##<span style="color:magenta">**Attrition Number & Percentage by Gender**</span>

```{r}

# i. Employee Attrition Number & Percentage
attr_number <- hr_df %>% 
                group_by(Attrition) %>% 
                dplyr::summarise(count = n()) %>%  
                mutate(att_pct = round(prop.table(count),2)*100) 

# Lets plot the Attrition Percentage side by side as Numbers could be misguiding to understand.
p123 <- ggplot(attr_number, aes(x=Attrition, y= att_pct,fill=Attrition, color=Attrition))+
        geom_bar(stat= "identity")+ 
        coord_flip()+
        theme_solarized()+
        labs(title ="Employee Attrition Number & Percentage",
               x = "Attrition \n",
               y = "Percentage (%)") +  
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "red", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(att_pct, "%")), color = "midnightblue", fontface = "bold.italic", size = 3) +
        geom_label(aes(label=count), color = "black", fontface = "bold", y= 0.7, hjust = 0, vjust =.5, size =3.5) +
        theme(panel.grid.major = element_line("white"), 
              panel.grid.minor = element_line("white"))+ 
        scale_fill_manual(values=c("springgreen","tomato")) +  
        scale_color_manual(values=c("springgreen","tomato")) + 
        theme(legend.position="none")

# ii. Employee Attrition Number by Gender
attr_gender <- hr_df %>% 
                group_by(Gender,Attrition) %>% 
                dplyr::summarise(count = n()) %>%  
                mutate(att_gender_percent = round(prop.table(count),2)*100) %>%  
                data.frame() 
attr_gender

p124 <- ggplot(attr_gender, aes(x=Gender, y= att_gender_percent,fill=Attrition, color=Attrition))+
        geom_area(stat= "identity")+ 
        coord_flip()+ 
        theme_solarized_2()+
        labs(title="Employee Attrition % by Gender",
                x = "Gender \n",
                y = "Attrition Percentage (%)") +  
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(att_gender_percent, "%")), color = "midnightblue", fontface = "bold.italic", size = 3) +
        theme(panel.grid.major = element_line("white"), 
              panel.grid.minor = element_line("white"))+ 
        scale_fill_manual(values=c("springgreen","tomato")) +  
        scale_color_manual(values=c("springgreen","tomato")) +
        theme(legend.position="none")

mean_age <- tapply(hr_df$Age, hr_df$Attrition, summary)
# mean_age

# i. Average Age Boxplot of Gender:
p125 <- ggplot(hr_df, aes(Attrition,Age, fill = Attrition))+
  geom_boxplot(outlier.colour="red", outlier.shape=8, outlier.size=2)+
  stat_summary(fun.y = "mean", geom = "point", shape = 16, size = 2, color = "white") +
  geom_hline(aes(yintercept=mean(Age)),color="darkblue", linetype="dashed", size=1)+
  theme_solarized()+
  facet_wrap(~Gender)+
  labs(title= "Average Age Employee Attrition by Gender",
       y = "Age \n",
       x = "Attrition")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  annotate("text", label = "Mean = 37.64 Years Old", x = 1, y = 40, color = "black", size = 2.5)+
  annotate("text", label = "Mean = 32.80 Years Old", x = 2, y = 30, color = "black", size = 2.5)+
  scale_fill_manual(values=c("springgreen","tomato")) +
  scale_color_manual(values=c("springgreen","tomato")) +
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Relationshiop between Age and Attrition", fontface='bold', size=12, colour = "red")
bottom_row <-plot_grid(p123,p124, ncol = 2,rel_heights = c(0.5, 0.5),labels = c("E","F"),rel_widths =  c(0.5, 0.5),scale = 0.97)

plot_grid(p125, bottom_row,nrow = 2, labels = c("","",""),rel_heights = c(0.5, 0.5, 1))

```

**E & F**

- 15% Leave the company while 85% still do work there.
- Out of 15 % who leave the company 16% are Male and 13% are Female.
- Average age of Employee who doesnt leave the company falls in Mean age of Entire Population of the workforce. Mean Age of the Employee who leave the company have less mean age in both Gender.Red Astrick Represents the outliers.

##<span style="color:magenta">**Attrition by Dept. & Gender**</span>

```{r}
# Calculate Percentage:-
attr_gender <- hr_df %>% 
                group_by(Attrition, EmpDepartment) %>% 
                dplyr::summarise(count = n()) %>% 
                mutate(att_dpt_pct = round(prop.table(count),2)*100) %>% data.frame() 

# i. Employee Attrition by Department.

p126 <- ggplot(attr_gender, aes(x=EmpDepartment, y=att_dpt_pct,fill=Attrition, color=Attrition))+
        geom_area(stat= "identity",position = position_stack())+ 
        coord_flip()+
        theme_few()+
        labs(title = "Percentage by Department",
               x = "Department \n ",
               y = "Attrition Percentage (%)") +  
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        geom_label(aes(label=paste0(att_dpt_pct, "%")), color = "black", fontface = "bold.italic", size =2.5,position = position_stack()) +
        scale_fill_manual(values=c("springgreen","tomato")) + 
        scale_color_manual(values=c("springgreen","tomato")) + 
        theme(legend.position = "none")

# ii. Employee Attrition Percentage by Department & Gender. 

# Calculate Percentage:-
attr_gender_dpt <- hr_df %>% 
                    group_by(EmpDepartment, Gender,Attrition) %>% 
                    dplyr::summarise(count = n()) %>%  
                    mutate(att_gender_dpt_pct = round(prop.table(count),2)*100) 

p127 <- ggplot(attr_gender_dpt, aes(x=EmpDepartment, y= att_gender_dpt_pct, fill=Attrition, color=Attrition))+
         geom_area(stat= "identity", position = position_stack())+ 
         coord_flip() + 
         facet_wrap(~Gender)+
         theme_few()+
         labs(title ="By Department & Gender",
                x = "Department \n",
                y = "Attrition Percentage (%)") +  
         theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
          theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
          theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
         geom_label(aes(label=paste0(att_gender_dpt_pct, "%")), color = "black", fontface ="bold.italic",size = 2,position = position_stack()) +
         scale_fill_manual(values=c("springgreen","tomato")) +  
         scale_color_manual(values=c("springgreen","tomato")) + 
         theme(strip.text = element_text(face="bold", size=5),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
         theme(legend.position = "none")

title <- ggdraw() + draw_label("Attrition Percentage ", fontface='bold', size=12, colour = "red")
bottom_row <-plot_grid(p126,p127, nrow =2,labels = c("G", "H"))

plot_grid(title, bottom_row,nrow = 2, labels = c("","",""),rel_heights = c(0.05, 1, 1))
```

**G**

- As guessed we have biggest number of attrition coming from 3 big department Sales leading the more attrition than any other department.


**H**

- When we break it down by the Gender we can see that Males and Females leave the company at the same rate. 
- In Finance we saw 2% Employee leaving the company and its all Male.None of the Female left the company.
- Most of the Female Working in Human Resource department seems to leave the company. Out of 4% of total attrition 24% of the Employee seems to be Female which is double than Male 11% leaving the company.

##<span style="color:magenta">**Attrition Number by Employee Job Role**</span>

Lets look if we could find some insights in the job Role. May be this could give us some insights on how the Attrition factor plays any role.

```{r}
p128 <- hr_df %>% 
  select(EmpJobRole,Attrition) %>% 
  group_by(EmpJobRole,Attrition) %>%
 dplyr::summarise(count = n()) %>%
  mutate(avg_inc = round(prop.table(count),2)*100) %>% 
  arrange(desc(avg_inc)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg_inc, fill =Attrition )) + 
  geom_bar(stat="identity", position=position_stack()) + 
  coord_flip()+
  theme_economist() +
  labs(x="Job Role \n",
       y="Percentage (%)", 
       title="Attrition") + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, color = "blue", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(x = EmpJobRole, label = paste0(round(avg_inc,2),"%")),hjust=0.5, vjust=0.5, size = 2.5, color =   'midnightblue',fontface = 'bold', position=position_stack())+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
   scale_fill_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")

p129 <- hr_df %>% 
  select(EmpJobRole,Attrition, Gender) %>% 
  group_by(EmpJobRole,Attrition,Gender) %>%
 dplyr::summarise(count = n()) %>%
  mutate(avg_inc = round(prop.table(count),2)*100) %>% 
  arrange(desc(avg_inc)) %>% 
  ggplot(aes(x=EmpJobRole, y=avg_inc, fill =Attrition )) + 
  geom_bar(stat="identity", position=position_stack()) + 
  facet_grid(~Gender)+
  coord_flip()+
  theme_economist() +
  labs(x="Job Role \n",
       y="Percentage (%)")+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_label(aes(x = EmpJobRole, label = paste0(round(avg_inc,2),"%")),hjust=0.5, vjust=0.5, size = 2, color =   'midnightblue',fontface = 'bold', position=position_stack())+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(axis.text.y = element_blank(), axis.title.y = element_blank())+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
   scale_fill_manual(values=c("springgreen","tomato"))+
  theme(legend.position="none")

title <- ggdraw() + draw_label("Job Role Attrition (%)", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p128,p129, nrow = 1,labels = c("G", "H")) 
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.04, 1, 1))
```

- Sales Representative contribute more for the attrition. Almost about 35% of them leave the company.
- Out of 35% Male and Female almost participate roughly equally. 54% are Female and 44% are Male.
- 3% Technical Lead are all Male.
- Seconds is Technical Architect.About 29% of Technical Architect leave the company and all of them who leave the company are Male.
- Senior Manager R&D. 13% Employee leave out of which half of them are Male and other half is Female.
- Research Director never leaves the company at all.
- 4% Manager who leaves the company are all Female.
- 3% Healthcare Representative who leave the company are all Male.
- 6% Finance Manager who leaves the company are all Male.
- Delivery Managers never leave the company at all.
- 10 % Data scientist who leave the company. Half of them are female.
- 6% Business Analyst who leave the company are all Male. 

**Looking at above insights company can see the patterns coming out of particular Gender and then decide what factors might result them to leave the company.**

- I have subset trying to find if there is any insights among any of the variables.
- There are in total 8 Employee who have left the company who are all Male.


```{r}
hr_df %>% 
  filter(Attrition == "Yes") %>% 
  filter(EmpJobRole %in% c("Technical Lead" ,"Technical Architect", "Healthcare Representative", "Finance Manager", "Business Analyst")) %>% kable(caption = "EmpJobRole with Attrition YES")%>% 
  kable_styling("striped", full_width = T) %>% scroll_box(width = "500px", height = "200px")
```

**ANALYSIS** 

- 5 out of 8 are Single.
- 4 Works in Development, 3 works in Finance and 1 in R&D
- 3 are Finance Manager, 2 are Technical Architect, 1 Technical Lead, 1 Business Analyst and 1 is Healthcare Representative.
- 6 out of 8 Travel Rarely.
- 3 out of 8 leave very far from Home.
- 5 out of 8 have Job Involvment category 3.
- 5 out of 8 have Job level 1.
- 5 out of 8 have worked only one previous company.
- 4 have worked OverTime and 3 have Not.
- Salary Hike Percent is from 11-19.
- 3 of them have Workexperience of more than 17 years.
- 6 out of 8 have WorkLife Balance score of 3 which is Better.
- 4 out of them have just spend about a year in this company.
- 5 out of 8 have been promoted last year.
- One of them is working for 5 years with Current Managers while rest of them have either 0,1,2,3 years with current Manager. Could this be one of the crucial factor for them to leave.
- 6 out of 8 have performance rating of 3.
- 3 have Bachelor Degree, 3 have Master Degree and 2 of them have No college Degree.
- one of them makes Hourly between 40-49, 3 of them makes between 50-59, 2 of them makes between 90-100$ an hour.

- We have seen Single leaving the company so Single creates High Volatility.
- Did 3 of them who have Bachelor degree left to get Higher Education Degree.
- All of them have Salary Hike percent.
- Was Current Managers somehow responsible for Employee to leave.
- We could deep digger to find out if cuurent Managers was somehow responsible for Employee to leave by categorising Employee who stayed under Current Manager and who left.

```{r}
ftable(hr_df$EmpJobRole,hr_df$Attrition,hr_df$YearsWithCurrManager)
```

- When I break it with Current Managers I didn't find any concurrent evidence.

##<span style="color:magenta">**Attrition by Job Role And Age_bin**</span>

```{r}
#ii. Age Distribution fill by Attrition
p130 <- ggplot(hr_df, aes(x =Age , y = EmpJobRole, fill = Attrition)) +
  geom_density_ridges() +
  theme_solarized() +
  labs(x ="Age",
       y ="Job Role") +
  theme(plot.title = element_text(size = 12, hjust = 0.2, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_vline(aes(xintercept=mean(Age)),color="darkblue", linetype="dashed", size=1) +
  scale_fill_manual(values=c("springgreen","tomato")) +
  theme(legend.position = "none")

title <- ggdraw() + draw_label("Employee Attrition by Job Role & Age", fontface='bold', size=12, colour = "red")
bottom_row <-suppressMessages(plot_grid(p130,nrow = 1,labels = "A"))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1))
```

- We can see bell shape curve in both people who stays and work and people who leaves the company.
- Senior Developer, Sales Representative, Manager R&D, Healthcare Representative  have early turnover before the mean age of Entire workforce.
- Blue dotted lines represent Mean Age of Workforce.
- Only Manufacturing Directors who tend to leave the company around the retirement Age.

##<span style="color:magenta">**JobSatisfaction & Attrition**</span>
 
How does the Job Satisfaction level play a role in terms of Attrition.

```{r}
hr_df$EmpJobSatisfaction <- as.factor(hr_df$EmpJobSatisfaction)

p131 <- hr_df %>% 
      select(EmpJobSatisfaction,EmpHourlyRate, Attrition) %>% 
      group_by(EmpJobSatisfaction, Attrition) %>%
      dplyr::summarize(Med=median(EmpHourlyRate)) %>%
      ggplot(aes(x=reorder(EmpJobSatisfaction, -Med), y=Med, color=Attrition)) + 
      geom_point(size=3) + 
      geom_segment(aes(x=EmpJobSatisfaction,xend=EmpJobSatisfaction, y=0,yend=Med)) +
      coord_flip() + 
      facet_wrap(~Attrition) +
      theme_economist() +
      labs( x = "Job Satisfaction \n",
            y = "Median Income") + 
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.text.x = element_text(angle=65, vjust=0.4),plot.title=element_text(hjust=0.5),
            strip.background = element_blank(), strip.text = element_blank()) + 
      geom_text(aes(x=EmpJobSatisfaction, y=0.01,label= paste0("$ ", round(Med,2))),hjust=-0.5,vjust=-0.5, size=4, color="midnightblue", fontface="italic",angle=360)+
      scale_color_manual(values=c("springgreen","tomato")) + 
      theme(legend.position="none")

p132 <- hr_df %>% 
      select(EmpJobSatisfaction,EmpHourlyRate, Attrition) %>% 
      group_by(EmpJobSatisfaction, Attrition) %>%
      dplyr::summarize(Med=median(EmpHourlyRate)) %>%
      ggplot(aes(x=reorder(EmpJobSatisfaction, -Med), y=Med, color=Attrition)) + 
      geom_point(size=3) + 
      geom_segment(aes(x=EmpJobSatisfaction,xend=EmpJobSatisfaction, y=0,yend=Med)) +
      coord_flip() +
      theme_economist() + 
      labs(title="Is Hourly Rate a Reason for Employees to Leave?",
            x= "Job Satisfaction \n",
            y="Median Income") +
      theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
      theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
      theme(axis.text.x = element_text(angle=65, vjust=0.6),plot.title=element_text(hjust=0.5),
            strip.background = element_blank(),strip.text = element_blank()) + 
      scale_color_manual(values=c("springgreen","tomato")) + 
      geom_text(aes(x=EmpJobSatisfaction, y=0.01,label= paste0("$ ")),hjust=-0.5,vjust=-0.5, size=4, color="midnightblue", fontface ="italic", angle=360)+
      theme(legend.position="none")



title <- ggdraw() + draw_label("Overall Satisfaction", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p131, p132, nrow=2,labels = c("A", "B"))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1))

```

How does the Salary Increment affects the Attrition Rate Differentaited by the Gender.

##<span style="color:magenta">**Hourly Income by Department & Attrition**</span>

How is Hourly Rate distributed across various Department?

```{r}
#0. Income | Attrition | Department
p133 <- hr_df %>% 
  select(EmpDepartment,EmpHourlyRate, Attrition) %>% 
  group_by(EmpDepartment,Attrition) %>%
  dplyr::summarize(avg_inc=mean(EmpHourlyRate)) %>% 
  arrange(desc(avg_inc)) %>% 
  ungroup(EmpDepartment,Attrition) %>% 
  ggplot(aes(x=EmpDepartment, y=avg_inc, fill=Attrition)) + 
  geom_bar(stat="identity", position="dodge") + 
  coord_flip()+
  facet_wrap(~Attrition) + 
  theme_minimal() +
  labs(x="Department \n",
       y="Hourly Rate", 
       title="Across the department and Attrition") + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  geom_text(aes(x = EmpDepartment, y = 1, label = paste0("$ ",round(avg_inc,2))),hjust=-0.5, vjust=.5, size = 4, color =   'midnightblue',fontface = 'bold',angle=360)+ 
  theme(axis.text.x = element_text(angle = 90,size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.text.y = element_text(size= 10), plot.title=element_text(hjust=0.5)) + 
  theme(axis.title.y = element_text(size= 10))+
  theme(strip.text = element_text(face="bold", size=7),
              strip.background = element_rect(fill="orange", color="black",size=0.5))+
  scale_fill_manual(values=c("springgreen","tomato")) + 
  scale_color_manual(values=c("springgreen","tomato")) +  
  theme(legend.position="none", plot.background=element_rect(fill="lavender"))

title <- ggdraw() + draw_label("Hourly Rate", fontface='bold', size=12, colour = "red")
bottom_row <- plot_grid(p133, nrow=1,labels = "A")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1))
```

##<span style="color:magenta">**Satisfaction level | PerformanceRating | EmpHourlyRate & Attrition**</span>


Let's see how does the Attrition factor is influenced by  Satisfaction level,  PerformanceRating, EmpHourlyRate.

```{r}
par(mfrow=c(2,3))

# Attrition = NO
hr_hist_no <- hr_df %>% filter(Attrition == "No")
hist(as.numeric(hr_hist_no$EmpJobSatisfaction),col="springgreen",xlab= "EmpJobSatisfaction",main = "Satisfaction level") 
hist(hr_hist_no$PerformanceRating,col="springgreen",xlab="Performance_Rating", main = "PerformanceRating")
hist(hr_hist_no$EmpHourlyRate,col="springgreen",xlab= "Hourly_Rate",main = "EmpHourlyRate")

# Attrition = YES
hr_hist_yes <- hr_df %>% filter(Attrition == "Yes")
hist(as.numeric(hr_hist_yes$EmpJobSatisfaction),col="tomato",xlab= "EmpJobSatisfaction", main = "Satisfaction level") 
hist(hr_hist_yes$PerformanceRating,col="tomato",xlab="Performance_Rating", main = "PerformanceRating")
hist(hr_hist_yes$EmpHourlyRate,col="tomato",xlab= "Hourly_Rate", main = "EmpHourlyRate")
```

Attrition Employee have low satisfaction level as well as low Hourly Rate.They have similar performance rating as that of Non Attrition Employee.

As we can see that there is definetly a reason for Employee to leave when it comes to Leaving or staying in the company. If the job satisfaction level is one or two, you are more likely to leave even increase in dollar per hour didn't save them. But if your satisfaction level is 3 or 4 and there is increase in hourly rate by $5 then you are more likely to stay.

##<span style="color:magenta">**Hourly Rate and its Impact on Attrition**</span>

```{r}
# i. Income | Attrition | Salary Hike Percent

library(cowplot)
p134 <- hr_df %>% 
             select(Gender, Attrition,EmpLastSalaryHikePercent, EmpHourlyRate) %>% 
             ggplot(aes(x=EmpLastSalaryHikePercent, y= EmpHourlyRate)) + 
             geom_jitter(aes(col=Attrition, shape = Gender), alpha=0.5) +
             coord_flip()+
             theme_tufte() + 
             labs(title="Hourly Rate & Hike Percent",
                  x="Salary Hike (%) \n",
                  y="Hourly Rate")+
             theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
             theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
             theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
             scale_color_manual(values=c("springgreen","tomato")) + 
             theme(axis.text.x=element_text(colour="black"),
                   axis.text.y=element_text(colour="black"))+
             theme(legend.position="none") 
# ii. PerformanceRating | EmpHourlyRate | Attrition

p135 <- hr_df %>%
            select(PerformanceRating, EmpHourlyRate, Attrition) %>%
            group_by(factor(PerformanceRating), Attrition) %>% 
            ggplot(aes(x=factor(PerformanceRating), y=EmpHourlyRate, fill=Attrition)) + 
            geom_boxplot() +
            coord_flip() +
            facet_wrap(~Attrition) + 
            theme_tufte() + 
            labs(title= "Hourly Rate & PerformanceRating",
                 x="Performance Rating \n",
                 y="Hourly Income") +
            theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
            theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
            theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
            scale_fill_manual(values=c("springgreen","tomato")) +
            theme(legend.position="none", strip.background = element_blank(),
                  strip.text.x = element_blank(), 
                  axis.text.x=element_text(colour="black"), 
                  axis.text.y=element_text(colour="black"),
                  axis.title=element_text(colour="black"), 
                  legend.text=element_text(color="black"))
           
#iii. OverTime | EmpHourlyRate | Attrition

p136 <- hr_df %>%
        select(OverTime, EmpHourlyRate, Attrition) %>%
        group_by(factor(OverTime), Attrition) %>% 
        ggplot(aes(x=factor(OverTime), y=EmpHourlyRate, fill=Attrition)) + 
        geom_boxplot() +
        coord_flip() +
        facet_wrap(~Attrition) + 
        theme_tufte() +
        labs(x="OverTime \n",y="Hourly Rate", title = "Hourly Rate & Over-Time") +
        theme(plot.title = element_text(size = 12, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_fill_manual(values=c("springgreen","tomato")) +
        theme(legend.position="none", strip.background = element_blank(),
              strip.text.x = element_blank(),
              axis.text.x=element_text(color="black"), 
              axis.text.y=element_text(color="black"),
              legend.text=element_text(color="black")) 
      
p137 <- hr_df %>%
        select(MaritalStatus, EmpHourlyRate, Attrition) %>%
        group_by(factor(MaritalStatus), Attrition) %>% 
        ggplot(aes(x=factor(MaritalStatus), y=EmpHourlyRate, fill=Attrition)) + 
        geom_boxplot() +
        coord_flip() +
        facet_wrap(~Attrition) + 
        theme_tufte() +
        labs(x="MaritalStatus \n",
             y="Hourly Rate",
             title = "Hourly Rate & Martial Status")+
        theme(plot.title = element_text(size = 14, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_fill_manual(values=c("springgreen","tomato")) +
        theme(legend.position="none", strip.background = element_blank(),
              strip.text.x = element_blank(), 
              axis.text.x=element_text(color="black"), 
              axis.text.y=element_text(color="black"),
              legend.text=element_text(color="black")) 

title <- ggdraw() + draw_label("Hourly Rate and its Impact on Attrition", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p134,p135,p136,p137, ncol = 2, labels = "AUTO")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.05, 1, 1))
```

We will see some more variables and how does it affect the attrition level. 
Some of the factors like overtime, Martial Status, Performance Rating and Last Salary hike percent can be considered in finding some interesting observations.

- We can observe that Higher Salary/hour person are less likely to leave if the salary Hike percent is more than 15. - We can see some cluster at  the bottom and spread out at the top. 
- Overtime Employee that are paid less hourly leaves the company than that are well paid.
- low performance rating who tends to leave the company are less paid averaging somewhere around $61-$65
- People who leave the company: Single Status Employee make more hourly than Married and divorced
- But incase of people who stays seems to have have same average hourly income.

##<span style="color:magenta">**Wage disparities among Department | Gender | Attrition**</span>

```{r}

# Wage gap between Male and Female
p138 <- hr_df %>% 
  group_by(EmpJobRole,EmpHourlyRate,Gender) %>% 
  ggplot(aes(EmpHourlyRate, fill=Gender)) +
  geom_histogram(binwidth = 1, alpha = 0.5, position = "dodge")+
  theme_minimal()+
  labs(x = "count", y = "Hourly Rate")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  scale_fill_manual(values=c("hotpink", "deep sky blue")) +
  scale_color_manual(values=c("hotpink", "deep sky blue")) +
  theme(panel.grid.major = element_line("white"), # grid lines matching to minimal 
      panel.grid.minor = element_line("white"))+ # grid lines matching to minimal 
  theme(legend.position = "none")

title <- ggdraw() + draw_label("Overall Hourly Income distribution by Gender", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p138, nrow = 1,labels = "AUTO")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06,1))

p139 <- hr_df %>% 
        group_by(EmpJobRole,EmpHourlyRate,Gender) %>% 
        ggplot(aes(x=EmpJobRole, y=EmpHourlyRate, color=Gender, fill=Gender)) +
        geom_boxplot() +
        coord_flip()+
        theme_minimal()+
        labs(title ="Based on  Job Role & by Attrition", x = "Job Role \n", y = "Hourly Rate")+
        geom_hline(aes(yintercept=mean(EmpHourlyRate)),color="darkblue", linetype="dashed", size=1) +
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_fill_manual(values=c("hotpink", "deep sky blue")) +
        scale_color_manual(values=c("hotpink", "deep sky blue")) +
        theme(legend.position = "none")

# ii. Wage disparities across Department.--> Attrition.
p140 <- ggplot(hr_df, aes(x=Gender, y=EmpHourlyRate, color=Gender, fill=Gender)) +
        geom_boxplot() +
        geom_hline(aes(yintercept=mean(EmpHourlyRate)),color="darkblue", linetype="dashed", size=1) +
        facet_grid(~EmpDepartment) +
        coord_flip()+
        theme_minimal()+
        labs(#title ="Based on  Department & by Attrition",
             x = "Gender \n",
             y = "Hourly Rate")+
        theme(plot.title = element_text(size = 10, hjust = 0.5, color = "blue", face="bold.italic"))+
        theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
        scale_fill_manual(values=c("hotpink", "deep sky blue")) +
        scale_color_manual(values=c("hotpink", "deep sky blue")) +
        theme(legend.position = "none")

title <- ggdraw() + draw_label("Gender Disparities in Hourly Income", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p139,p140, nrow = 2,labels = c("B","C"),rel_heights = c(1.3, 0.7))
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06, 1.3, 0.7))
```

- As we can see it's not true that Females do make less money hourly in same position. It depends upon the Job Role.
- In some Job Role they seems to make more money hourly than Male as we can see that in Sales Executive Role,Research Scientist Role,Technical Architecture and many more.
- As we can see Females are paid less Hourly compare to Male after we grouped by Same job Role.
- As we can see it to be True in Human Resource mostly, Development, Finance.
- But incase of Sales that is not true that could be reason we have seen more Female in Sales Department than Men.
- In the field of Data Science Female tends to make more hourly than Male.
- 

Let's group by EmpJobRole,TotalWorkExperienceInYears,ExperienceYearsInCurrentRole,EmpHourlyRate, Education level & Gender and see if this still holds true.


As we can see yes there is some wage disparities among male and Female although they have same or almost similar level of experience in certian roles.
- It can be mostly seen in Development, Finance, HR department.
- In HR there are some outliers as well in Female Popultaion.
- It is also true that Men are paid quite less in Sales, R&D department.
- In DS field womens are paid quite more for same job role and experience than Male even after considering all the possible factors.

##<span style="color:magenta">**Education level & Attrition**</span>


How does the Level of Education play role in leaving the company. 

In terms of ranking who are more likely to leave are 
- 19% Workforce who doesn't have any college degree.
- 15% Workforce who have only college degree
- 15% Workforce who have only Bachelor degree
- 13 % Workforce who have only Master Degree.
- 12 % Workforce who have highest degree Phd.
- When we break down by gender we can see Male population who have Master degree(76%) are more likely to leave and on Female side (~60%) who have Phd. 

#<span style="color:red">**Percent Difference (%)**</span>

```{r}
# What's the difference between in Dailyrates by attrition and jobrole status.
attrition_daily <- hr_df %>% 
                     select(EmpJobRole, Attrition, EmpHourlyRate) %>%
                     group_by(EmpJobRole) %>% 
                     filter(Attrition == "Yes") %>% 
                     dplyr::summarize(avg_attrition=mean(EmpHourlyRate))


no_attrition_daily <- hr_df %>% 
                        select(EmpJobRole, Attrition, EmpHourlyRate) %>% 
                        group_by(EmpJobRole) %>% 
                        filter(Attrition == "No") %>% 
                        dplyr::summarize(avg_no_attrition=mean(EmpHourlyRate))

combined_df <- merge(attrition_daily, no_attrition_daily)
colourCount = length(unique(combined_df$JobRole))

p141 <- combined_df %>% 
                mutate(pct_diff=round(((avg_no_attrition - avg_attrition)/avg_no_attrition),2) * 100) %>%
                ggplot(aes(x=reorder(EmpJobRole,pct_diff), y=pct_diff, fill=EmpJobRole)) +
                geom_bar(stat="identity") +
                coord_flip() +
                theme_economist() +
                labs(x="JobRole \n", y=" Difference (%)") +
                theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
                theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
                theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
                geom_label(aes(label=paste0(pct_diff, "%")), colour = "white", fontface = "italic", hjust=0.2)+
                theme(legend.position = "none")
title <- ggdraw() + draw_label("Percent Difference Charged by Day", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p141, nrow = 1,labels = "AUTO")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06,1))
```

#<span style="color:red">**Correlationship Matrix.**</span>
```{r}
# Create Correlation Matrix of Variables

# JobSatisfaction as integer again.
hr_df$EmpJobSatisfaction <- as.integer(hr_df$EmpJobSatisfaction)

nums <- select_if(hr_df, is.numeric)
cormat <- round(cor(nums), 2)
p142 <- melt(cormat) %>% 
  ggplot(aes(x=Var1, y=Var2, fill=value)) +
  theme_minimal() +
  labs(fill="Pearson Correlation") +
  geom_tile(color="gray") +
  xlab("Variables") +
  ylab("Variables")+
  theme(plot.title = element_text(size = 12, hjust = 0.5, color = "red", face="bold.italic"))+
  theme(axis.title.x = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.title.y = element_text(family="Times",size=12,color = "blue",vjust=-1.5,hjust=0.5)) +
  theme(axis.text.x = element_text(angle = 90,size=10),axis.text.y = element_text(size=10)) +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white")+
  theme(axis.text.x = element_text(angle = 90))+
  theme(legend.position = "none")

title <- ggdraw() + draw_label("Pearson Correlation", fontface='bold', size= 12, colour = "red")
bottom_row <- plot_grid(p142, nrow = 1,labels = "AUTO")
plot_grid(title, bottom_row,nrow = 2, labels = c("", "", "C"),rel_heights = c(0.06,1))
```

- Can see the pearson Correlation between the variables.

<center><font size = 4, color="magenta"><span style="background:yellow">**YOU MADE IT**</span></font></center>



- I know its pretty long rather than breaking it down I thought of compiling single notebook.
**Thank you for Reading the Post.Hope you enjoyed reading as much as "fun" I had making it.**

**Please do provide feedback/comment if you like any part of it. Would like to do better in future projects.**



🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏



🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏🙏
